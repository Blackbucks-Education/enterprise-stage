<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="icon" type="image/x-icon" href="img/sidebar logo.png" />

    <link rel="stylesheet" href="css/nav_log.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
    <title>Job Applications</title>
    <style>
        .css1{
            background-color: #e2e2e2;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            text-align: left;
        }
        
        th {
            background-color: #4C4267;
            color: white;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        tr:hover {
            background-color: #ddd;
        }

       
        .usercard {
            width: 95%;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        .roww{
    display: flex;
    flex-direction: row;
    align-items: center;
}
.marginr{
    margin-right: 10px;
}
.grey{
    color: rgba(0, 0, 0, 0.7);
}
.f14{
    font-size: 14px;
}
    </style>
</head>

<body>
    <script>
        window.userRole = "<%= user.role %>";
      </script>
      <script src="js/rolebase.js"></script>
      

   
    <div class="supercss">
         <div class="sidebar">
        <a class="logo" style="text-align: center;align-items:center;padding:5px">
           <img src="img/sidebar logo.png" alt="Logo" style="width: 64px; max-width: 120px;height:73px;">
        </a>
       <a href="myDashboard" class="menu-item" id="dashboard-link">
            <img src="img/dash_white.png" alt="dash" style="width: 20px; height: 20px"><span style="color:white">My Dashboard</span>
        </a>
         <a href="employabilityReport" class="menu-item">
                <img src="img/emp.png" alt="dash" style="width: 20px; height: 20px;"><span>Employbility</span>
            </a>
        <a href="https://admin.hackathon.blackbucks.me"  class="menu-item" >
            <img alt="Assessment icon" src="img/assessment.png" style="width: 20px; height: 20px;">
            <span>Assessments</span></a>
       
         <a href="jobsDashboard" class="menu-item" style="background-color: #88EB4C;">
                <img src="img/jobs_black.png" alt="jobs" style="width: 20px; height: 19px;"><span style="color:black;font-weight:bold">Jobs</span>
             </a>
        <a href="https://admin.hackathon.blackbucks.me/createAndManageCourse/"  class="menu-item" >
            <img alt="course icon" src="img/course.png" style="width: 20px; height: 20px;"> 
            <span>Course</span></a>
        <a href="https://admin.hackathon.blackbucks.me/lessonPlan/"  class="menu-item" >
            <img alt="lessonplan icon" src="img/lessonplan.png" style="width: 20px; height: 20px;">
            <span>Lesson Plan</span></a>
        
                <a href="trainingsDashboard" class="menu-item">
                    <img src="img/trainings.png" alt="trainings" style="width: 20px; height: 20px;"><span>Trainings</span>
                 </a>
                 <a href="internshipsDashboard" class="menu-item">
                    <img
                      src="img/internship_whiteicon.png"
                      alt="manage"
                      style="width: 20px; height: auto"
                    /><span>Internships</span>
                  </a>
        <a href="https://admin.hackathon.blackbucks.me/createAndManageLabTest/"  class="menu-item" >
                    <img alt="vpl icon" src="img/vpl.png" style="width: 20px; height: 20px;">
                    <span>VPL</span></a>
       
         

             
     </div>
     
           <div class="css">
            <div class="css0">
                <div id="navbar-container"></div>
            </div>
           <div class="css1">
    <div class="main-container">
        <div class="roww marginr">
            <img
              src="img/jobsgrey.png"
              alt="internship icon"
              style="width: 14px; height: 14px; margin-right: 5px"
            />
            <a href="jobsDashboard" style="text-decoration: none;">
              <p class="grey f14 marginr">
                Jobs Dashboard <i class="fa-solid fa-chevron-right f10 marginl grey"></i>
              </p></a>
            <p class="f14">Job Applications</p>
          </div>
        <div class="usercard">
            <h2><span id="company-title"></span> Job Applications</h2>
            
            <div id="job-applications-table"></div>
            <div id="error-message" style="color: red;"></div>
        </div>
    </div>
    </div>
    </div>

    

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const jobId = urlParams.get('job_post_id');

            if (jobId) {
                fetch(`api/job_application/data/${jobId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (Array.isArray(data) && data.length > 0) {
                            const companyName = data[0].company_title;
                            document.getElementById('company-title').textContent = `${companyName}`;
                        }
                        generateTable(data);
                    })
                    .catch(error => {
                        console.error('Error fetching job applications:', error);
                        document.getElementById('error-message').textContent = `Error fetching job applications: ${error.message}`;
                    });
            }
        });

        function generateTable(data) {
            if (!Array.isArray(data) || data.length === 0) {
                document.getElementById('error-message').textContent = 'No job applications found.';
                return;
            }

            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');

            const headers = ['Name', 'Email', 'Roll Number', 'College Name', 'Company', 'Job Title'];
            const headerRow = document.createElement('tr');
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            data.forEach(application => {
                const row = document.createElement('tr');
                Object.values(application).forEach(value => {
                    const cell = document.createElement('td');
                    cell.textContent = value;
                    row.appendChild(cell);
                });
                tbody.appendChild(row);
            });
            table.appendChild(tbody);

            const tableContainer = document.getElementById('job-applications-table');
            tableContainer.innerHTML = '';
            tableContainer.appendChild(table);
        }
    </script>

<script src="js/navbar_logout.js"></script>

</body>

</html>

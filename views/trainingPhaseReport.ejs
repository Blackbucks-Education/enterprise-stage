<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/css/phase_analysis.css" />
    <link rel="shortcut icon" href="img/sidebar logo.png" type="image/x-icon" />
    <link rel="stylesheet" href="css/nav_log.css" />
    <link rel="stylesheet" href="css/common.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>
    <title>Phase Analysis</title>
  </head>
  <body>
    <script>
      window.userRole = "<%= user.role %>";
    </script>
    <script src="js/rolebase.js"></script>
    
    <style>
      .nodata {
        /* border: 1px solid rgba(0, 0, 0, 0.7); */
        border-radius: 10px;
        padding: 10px;
        position: relative;
        text-align: center;
        font-size: 12px;
        color: rgba(0, 0, 0, 0.7);
        margin: 10px;
      }

      


.shimmer-table {
  width: 100%;
  border-collapse: collapse;
  background-color: #fff;
  overflow: hidden;
}

.shimmer-table th, .shimmer-table td {
  padding: 10px;
  border: 1px solid #ccc;
  background-color: transparent !important;
  text-align: center;
  position: relative;
}

/* Shimmer Effect */
.shimmer {
  display: inline-block;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

@keyframes shimmer {
  0% {
      background-position: 200% 0;
  }
  100% {
      background-position: -200% 0;
  }
}

/* Placeholder styles */
.shimmer-cell {
  height: 20px;
  background-color: #f0f0f0;
  position: relative;
}

.shimmer-header {
  height: 30px;
  background-color: #f0f0f0;
  position: relative;
}

.shimmer-header::before,
.shimmer-cell::before {
  content: '';
  display: block;
  height: 100%;
  width: 100%;
}

/* Add border radius to shimmer cells */
.shimmer-cell,
.shimmer-header {
  border-radius: 4px;
}
    </style>

    <div class="supercss">
      <div class="sidebar">
        <a
          class="logo"
          style="text-align: center; align-items: center; padding: 5px"
        >
          <img
            src="img/sidebar logo.png"
            alt="Logo"
            style="width: 58px; max-width: 70px; height: 80px"
          />
        </a>
        <a href="myDashboard" class="menu-item" id="dashboard-link">
          <img
            src="img/dash_white.png"
            alt="dash"
            style="max-width: 22px; height: 22px"
          /><span style="color: white">Dashboard</span>
        </a>
        <a href="employabilityReport" class="menu-item">
          <img
            src="img/emp.png"
            alt="dash"
            style="max-width: 18px; height: 20px"
          /><span>Employability</span>
        </a>
        <a href="https://admin.hackathon.blackbucks.me" class="menu-item">
          <img
            alt="Assessment icon"
            src="img/assessment.png"
            style="max-width: 19px; height: 19.5px"
          />
          <span>Assessments</span></a
        >

        <a href="jobsDashboard" class="menu-item">
          <img
            src="img/jobs.png"
            alt="jobs"
            style="max-width: 20px; height: 21px"
          /><span>Jobs</span>
        </a>
        <a
          href="https://admin.hackathon.blackbucks.me/createAndManageCourse/"
          class="menu-item"
        >
          <img
            alt="course icon"
            src="img/course.png"
            style="max-width: 19px; height: 20px"
          />
          <span>Course</span></a
        >
        <a
          href="https://admin.hackathon.blackbucks.me/lessonPlan/"
          class="menu-item"
        >
          <img
            alt="lessonplan icon"
            src="img/lessonplan.png"
            style="max-width: 23px; height: 18px"
          />
          <span>Lesson Plan</span></a
        >

        <a
          href="trainingsDashboard"
          class="menu-item active"
          style="background-color: #88eb4c"
        >
          <img
            src="img/trainings_black.png"
            alt="trainings"
            style="max-width: 27px; height: 21px"
          /><span style="color: black; font-weight: bold">Trainings</span>
        </a>
        <a href="internshipsDashboard" class="menu-item">
          <img
            src="img/internship_whiteicon.png"
            alt="manage"
            style="width: 20px; height: auto"
            style="width: 20px; height: auto"
          /><span>Internships</span>
        </a>
        <a
          href="https://admin.hackathon.blackbucks.me/createAndManageLabTest/"
          class="menu-item"
        >
          <img
            alt="vpl icon"
            src="img/vpl.png"
            style="max-width: 19px; height: 17px"
          />
          <span>VPL</span></a
        >
      </div>

      <div class="css">
        <div class="css0">
          <div id="navbar-container"></div>
      </div>
        <div class="css1">
          <div class="main-container">
            <div class="roww marginr">
              <img
                src="img/traininggrey.png"
                alt="internship icon"
                style="width: 14px; height: 14px; margin-right: 5px"
              />
              <p class="grey f14 marginr">
                Trainings
                <i class="fa-solid fa-chevron-right f10 marginl grey"></i>
              </p>
              <p class="f14"><span id="phase-title"></span> Overview</p>
            </div>

            <div class="topnav">
              <a
                href="#Overview"
                class="active nav-item"
                onclick="smoothScroll('Overview')"
              >
                <img src="img/fsdtab.png" alt="fsdoverview" />
                <span style="padding-left: 5px">Trainings Overview</span>
              </a>
              
              <a
                href="#Student-Activity"
                class="nav-item"
                onclick="smoothScroll('Student-Activity')"
              >
                <img
                  src="img/activity.png"
                  alt="activity"
                  style="width: 15px; height: 15px"
                />
                <span style="padding-left: 5px">Student Activities</span>
              </a>
              <!-- <a href="#projects" class="nav-item" onclick="smoothScroll('projects')">
                <img
                  src="img/activity.png"
                  alt="activity"
                  style="width: 15px; height: 15px"
                />
                <span style="padding-left: 5px">Projects</span>
              </a> -->
              <a
                href="#student-attendance"
                class="nav-item"
                onclick="smoothScroll('student-attendance')"
              >
                <img
                  src="img/activity.png"
                  alt="activity"
                  style="width: 15px; height: 15px"
                />
                <span style="padding-left: 5px">Student Attendance</span>
              </a>
              <a
                href="#candidates"
                class="nav-item"
                onclick="smoothScroll('candidates')"
              >
                <img src="img/candidates.png" alt="" />
                <span style="padding-left: 5px">Enrolled Candidates</span>
              </a>
            </div>

            <div
              class="overview section post"
              id="Overview"
              style="border: none; padding: 0"
            >
              <h3 class="f22 font600"><span id="title"></span> Overview</h3>
              <div class="suboverview">
                <div class="lefthalf">
                  <div class="row">
                    <div
                      class="quarter gradient-background active"
                      onclick="showRightHalf('live-sessions' , this)"
                    >
                      <div>
                        <p>Live Sessions</p>
                        <span id="live-session-count">0</span>
                      </div>

                      <div class="circle active">
                        <img src="img/ls.png" alt="live sessions" />
                      </div>
                    </div>
                    <div
                      class="quarter"
                      onclick="showRightHalf('assessments', this)"
                    >
                      <div>
                        <p>Assessments</p>
                        <span id="a-assessments">0</span>
                      </div>
                      <div class="circle">
                        <img src="img/fsd-options.png" alt="Assessments" />
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div
                      class="quarter"
                      onclick="showRightHalf('employability-test', this)"
                    >
                      <div>
                        <p>Employability Tests</p>
                        <span id="employability_count">0</span>
                      </div>
                      <div class="circle">
                        <img src="img/fsd-options.png" alt="tests" />
                      </div>
                    </div>
                    <div class="quarter disabled">
                      <div>
                        <p>Projects</p>
                        <span>0</span>
                      </div>
                      <div class="circle">
                        <img src="img/fsd-options.png" alt="projects" />
                      </div>
                      <div class="overlay">Not Available Right Now</div>
                    </div>
                  </div>
                </div>
                <div class="gap"></div>
                <div class="righthalf">
                  <!------------------overview-Livesessions------------------>
                  <div class="righthalf-part active" id="live-sessions">
                    <h4 class="f20 font600">Live Sessions</h4>
                    <hr />
                    <div class="ls-options">
                      <div class="ls-table">
                        <table class="otable">
                          <thead>
                            <tr>
                              <th>Overview</th>
                              <th style="text-wrap: nowrap;">Live Sessions</th>
                            </tr>
                          </thead>
                          <tbody>
                            
                            <tr>
                              <td>
                                <span class="smallcircle sc4"></span>
                                Hours Covered
                              </td>
                              <td id="hours-covered">0</td>
                            </tr>
                            <tr>
                              <td>
                                <span class="smallcircle sc1"></span>
                                Overall Feedback
                              </td>
                              <td id="overall-feedback">0</td>
                            </tr>
                            <tr>
                              <td style="text-wrap: nowrap;">
                                <span class="smallcircle sc2"></span>
                                Session Interactiveness
                              </td>
                              <td id="session-interactiveness">0</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>

                  <!-----------------Overview- Assessments----------->
                  <div class="righthalf-part" id="assessments">
                    <h4 class="f20 font600">Assessments</h4>
                    <hr />
                    <div class="a-options">
                      <div class="a-table">
                        <table class="assessment-table">
                          <thead>
                            <tr>
                              <th>Overall</th>
                              <th>Assessments</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                <span class="smallcircle sc3"></span>
                                Daily Test
                              </td>
                              <td id="a-dailyTests">0</td>
                            </tr>
                            <tr>
                              <td>
                                <span class="smallcircle sc1"></span>
                                Assignments
                              </td>
                              <td id="a-assignments">0</td>
                            </tr>

                            <tr>
                              <td>
                                <span class="smallcircle sc4"></span>
                                Grand Test
                              </td>
                              <td id="a-grandTests">0</td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div class="a-graph">
                        <canvas id="myChart-assessment" height="auto"></canvas>
                      </div>
                    </div>
                  </div>

                  <!----------------Overview-Employabitity test-------------->
                  <div class="righthalf-part" id="employability-test">
                    <div
                      style="
                        display: flex;
                        flex-direction: row;
                        justify-content: space-between;
                      "
                    >
                      <h4 class="f20 font600">Employability Test</h4>
                    </div>
                    <div class="oemp-graph" style="height: 160px">
                      <canvas id="myChart-employability" height="200"></canvas>
                      <p id="chart-error-message" style="display: none">
                        No data available
                      </p>
                    </div>
                  </div>

                  <!------------------Overview- Projects---------------->
                  <div class="righthalf-part" id="projectss">
                    <div
                      style="
                        display: flex;
                        flex-direction: row;
                        justify-content: space-around;
                      "
                    >
                      <h4 class="f20 font600">Projects</h4>
                      <div
                        style="
                          display: flex;
                          flex-direction: row;
                          align-items: center;
                        "
                      >
                        <div class="smallcircle sc2"></div>
                        <p>Enroll Student</p>
                      </div>

                      <div
                        style="
                          display: flex;
                          flex-direction: row;
                          align-items: center;
                        "
                      >
                        <div class="smallcircle sc3"></div>
                        <p>Available Project</p>
                      </div>
                    </div>

                    <hr />
                    <table class="oproj-graph">
                      <tr>
                        <td>
                          <section class="total-section">
                            <!-- Use Font Awesome version 5 user icon -->
                            <i class="fas fa-user"></i>
                            <svg class="svg">
                              <circle
                                id="track"
                                cx="40"
                                cy="40"
                                r="35"
                              ></circle>
                              <!-- Adjusted circle radius -->
                              <circle
                                id="progress"
                                cx="40"
                                cy="40"
                                r="35"
                              ></circle>
                              <!-- Adjusted circle radius -->
                            </svg>
                            <span id="percentage" style="display: none"></span>
                          </section>
                        </td>
                        <td style="margin-left: 40px; padding-left: 40px">
                          <div style="display: flex; flex-direction: column">
                            <span style="margin: 0; padding: 0">1,235</span>
                            <p style="margin-top: 4px; padding: 0">
                              How Many Enroll
                            </p>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <section class="project-section">
                            <!-- Use Font Awesome version 5 user icon -->
                            <i class="fas fa-tag"></i>
                            <svg class="svg">
                              <circle
                                id="track"
                                cx="40"
                                cy="40"
                                r="35"
                              ></circle>
                              <!-- Adjusted circle radius -->
                              <circle
                                id="progress"
                                cx="40"
                                cy="40"
                                r="35"
                              ></circle>
                              <!-- Adjusted circle radius -->
                            </svg>
                            <span id="percentage" style="display: none"></span>
                          </section>
                        </td>
                        <td style="margin-left: 40px; padding-left: 40px">
                          <div style="display: flex; flex-direction: column">
                            <span style="margin: 0; padding: 0">456</span>
                            <p style="margin-top: 4px; padding: 0">
                              Available Projects <br />Student Yet to Choose
                              Project
                            </p>
                          </div>
                        </td>
                      </tr>
                    </table>

                    <script>
                      function updateProgress(percentage) {
                        const progressCircle =
                          document.getElementById("progress");
                        const circumference =
                          2 *
                          Math.PI *
                          parseFloat(progressCircle.getAttribute("r"));
                        const offset = circumference * (1 - percentage / 100);
                        progressCircle.style.strokeDashoffset = offset;
                        document.getElementById(
                          "percentage"
                        ).textContent = `${percentage}%`;
                      }

                      // Example: Update progress to 50%
                      updateProgress(465); // Call this function with your desired percentage value
                    </script>
                  </div>
                </div>
              </div>
            </div>

           
            <!--------------------Syllabus------------------------>
            <div class="Live Sessions Syllabus section">
              <h3 class="f22 font600">Live Session</h3>
              <div class="dt-tablecontainer2">
                <table id="livesession-syllabusTable">
                  <thead>
                      <tr>
                          <th>Event Title</th>
                          <th>Faculty</th>
                          <th>Session Details</th>
                          <th>Session Materials</th>
                      </tr>
                  </thead>
                  <tbody>
                  </tbody>
              </table>
              
              
              <div id="shimmerTableCont">
                <table class="shimmer-table">
                  <thead>
                      <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th></th>
              
                      </tr>
                  </thead>
                  <tbody>
                      <!-- Row 1 -->
                       
                      <tr>
                          
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                      </tr>
                      
                      <tr>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                      </tr>
                      
                      <tr>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                      </tr>
                      
                      <!-- Row 2 -->
                      <tr>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                      </tr>
                      <!-- Row 3 -->
                      <tr>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                      </tr>
              
                      <tr>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                          <td><div class="shimmer shimmer-cell"></div></td>
                      </tr>
                      
                  </tbody>
              </table>
              </div>

              <div id="livesession-syllabusTable-noData" style="display:none;">
                <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                  <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                  <p style="font-size:16px;line-height:24px;">No Live Sessions</p>
              </div>
              </div>
              
                  
              </div>

            </div>

            <!------------------------Student activity section-------------------------------------->
            <div class="student-activity section post" id="Student-Activity">
              <h3 class="f22 font600">Student Activity</h3>

              <div
                class="sa-topnav"
                style="margin-top: 20px; margin-bottom: 10px"
              >
                <div class="sa-links-container">
                  <a
                  href="#absenteeslist"
                  class="active"
                  onclick="toggleSection('Absentees-List', this)"
                >
                  <img
                    src="img/activity.png"
                    alt="activity"
                    style="width: 15px; height: 15px"
                  />
                  <span>Summary</span>
                </a>
                  <a
                    href="#dailytest"
                    
                    onclick="toggleSection('daily-test', this)"
                  >
                    <img
                      src="img/fsdtab.png"
                      alt="daily test"
                      width="18px"
                      height="16px"
                    />
                    <span>Daily Test</span>
                  </a>
                  <a
                    href="#grandtest"
                    onclick="toggleSection('grand-test', this)"
                  >
                    <img
                      src="img/candidates.png"
                      alt="grand test"
                      style="width: 16px; height: 16px; padding-left: 5px"
                    />
                    <span>Grand Test</span>
                  </a>
                  

                  <a
                    href="#emptest"
                    onclick="toggleSection('Employability-test', this)"
                  >
                    <img
                      src="img/activity.png"
                      alt="activity"
                      style="width: 15px; height: 15px"
                    />
                    <span>Employability Test</span>
                  </a>

                  <a
                  href="#inactive-test"
                  onclick="toggleSection('inactive-test', this)"
                >
                  <img
                    src="img/activity.png"
                    alt="activity"
                    style="width: 15px; height: 15px"
                  />
                  <span>Inactive Students</span>
                </a>

                
                </div>
              </div>
             
              <div id="shimmer-table-for-student-activity" style="display: block;">
                    <%- include('shimmerTable') %>
              </div>

              <div class="stu-act " id="daily-test">
                <div class="download-data-div" id="daily-test-download">
                  <a href="#" class="download-btn" onclick="downloadCSV('daily_test')">Download</a>
                </div>
                <div style="width: 100%; border-radius: 10px; overflow: hidden; margin-top: 40px;">
                  <div
                    style="width: 100%; display: flex; justify-content: center"
                  >
                    <div id="daily-result-message" class="nodata" style="display: none;">
                    
                    </div>
                  </div>
                  <div class="dt-tablecontainer2" style="margin-top: 20px;">
                    <table>
                      <thead class="dthead" id="dailytesttable-head"></thead>
                      <tbody id="dailytesttable-body"></tbody>
                    </table>
                  </div>
                </div>
                <div class="pagination" id="pagination-controls">
                  <button id="prevPage" onclick="prevPage()">Previous</button>
                  <div id="pageNumbers"></div>
                  <button id="nextPage" onclick="nextPage()">Next</button>
                </div>
              </div>

              <div class="stu-act" id="grand-test">
                <div class="download-data-div" id="grand-test-download">
                  <a href="#" class="download-btn" onclick="downloadCSV('grand_test')">Download</a>
                </div>
                <div style="width: 100%; border-radius: 10px; overflow: hidden">
                  <div
                    style="width: 100%; display: flex; justify-content: center"
                  >
                    <div id="result-message" class="nodata"></div>
                  </div>
                  <div class="dt-tablecontainer2">
                    <table>
                      <thead class="dthead" id="grandtesttable-head"></thead>
                      <tbody id="grandtesttable-body"></tbody>
                    </table>
                  </div>
                </div>
                <div class="pagination" id="grand-pagination-controls">
                  <button id="grandprevPage" onclick="grandprevPage()">
                    Previous
                  </button>
                  <div id="grandpageNumbers"></div>
                  <button id="grandnextPage" onclick="grandnextPage()">
                    Next
                  </button>
                </div>
              </div>

            
              <div class="stu-act" id="Employability-test">
                <div class="download-data-div" id="employability-test-download" style="margin-bottom: 20px;">
                  <a href="#" class="download-btn" onclick="downloadCSV('employability_students_data')">Download</a>
                </div>
                <div style="width: 100%; border-radius: 10px; overflow: hidden">
                  <div style="width: 100%; display: flex; justify-content: center">
                    <div id="emp-result-message" class="nodata" style="display: none;"></div>
                  </div>
                  <div class="dt-tablecontainer2">
                    <table>
                      <thead class="dthead" id="emptesttable-head"></thead>
                      <tbody id="emptesttable-body"></tbody>
                    </table>
                  </div>
                </div>
                <div class="pagination" id="emp-pagination-controls">
                  <button id="empprevPage">Previous</button>
                  <div id="emppageNumbers"></div>
                  <button id="empnextPage">Next</button>
                </div>
              </div>
              

              <div class="stu-act active" id="Absentees-List">
                <div style="width: 100%; display: flex; justify-content: center">
                  <div id="testreport-result-message" ></div>
                </div>
                <div class="inactive-table-test dt-tablecontainer2">
                  <table>
                    <thead class="dthead" style="opacity: 0;" id="summary-dthead">
                      <tr>
                        <th>Event Title</th>
                        <th>Total Students</th>
                        <th>Present Students</th>
                        <th>Absent Students</th>
                        <th>Attendance Rate (%)</th>
                        <th>Average Score</th>
                        <th>Absentees Report</th>
                      </tr>
                    </thead>
                    <tbody id="event-data">
                      <!-- Event data will be inserted here by JavaScript -->
                    </tbody>
                  </table>
                </div>
                <div class="pagination" id="absentees-pagination-controls">
                  <button
                    id="assessmentabsenteesprevPage"
                    onclick="absenteesPrevPage()"
                    style="font-size: 14px"
                  >
                    Previous
                  </button>
                  <div id="assessmentabsenteespageNumbers"></div>
                  <button
                    id="assessmentabsenteesnextPage"
                    onclick="absenteesNextPage()"
                    style="font-size: 14px"
                  >
                    Next
                  </button>
                </div>
              </div>
              

              <div class="stu-act" id="inactive-test">
                <div class="download-data-div" id="download-inactive-test" style="margin-bottom: 15px;">
                  <a href="#" class="download-btn" onclick="downloadCSV('assessments_inactive_students')">Download</a>
                </div>

                <div style="margin-top: 20px;">
                  <div style="display: none;" id="nodata-div-inactive-students">
                    <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;" >
                      <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                      <p style="font-size:16px;line-height:24px;">The test has not been conducted yet, so there are no results to show. Please stay tuned for updates.</p>
                    </div>
                  </div>
                  
                <div class="dt-tablecontainer2" >
                  <table>
                    <thead class="dthead" id="inactivestudentsassessmentstable-head"></thead>
                    <tbody id="inactivestudentsassessmentstable-body"></tbody>
                  </table>
                </div></div>
                <div class="pagination" id="inactive-pagination-controls">
                  <button
                    id="inactivePrevPageBtn"
                    style="font-size: 14px"
                  >
                    Previous
                  </button>
                  <div id="inactivePageNumbers"></div>
                  <button
                    id="inactiveNextPageBtn"
                    style="font-size: 14px"
                  >
                    Next
                  </button>
                </div>
              </div>
              
            </div>


            <!---------------------Projectss-->
            <!-- <div class="projects disabled post" id="projects">
        <h3 class="f22 font600">Projects</h3>
        <div class="pro-sections section">
          <div class="project1">
           <table>
    <thead>
        <tr>
            <th>Name</th>
            <th>College Reg.No</th>
            <th>Email</th>
            <th>Project Chosen</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Ravi Kumar
            </td>
            <td>CRN001</td>
            <td>ravi.kumar@gmail.com</td>
            <td>Java Web Application</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Arun Prasad
            </td>
            <td>CRN002</td>
            <td>arun.prasad@gmail.com</td>
            <td>Java E-commerce Platform</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Kavya Nair
            </td>
            <td>CRN003</td>
            <td>kavya.nair@gmail.com</td>
            <td>Java Inventory Management</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Lakshmi Reddy
            </td>
            <td>CRN004</td>
            <td>lakshmi.reddy@gmail.com</td>
            <td>Java Banking System</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Nithya Menon
            </td>
            <td>CRN005</td>
            <td>nithya.menon@gmail.com</td>
            <td>Java Online Booking System</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Sanjay Rao
            </td>
            <td>CRN006</td>
            <td>sanjay.rao@gmail.com</td>
            <td>Java Social Media App</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Meena Iyer
            </td>
            <td>CRN007</td>
            <td>meena.iyer@gmail.com</td>
            <td>Java Chat Application</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Vikram Reddy
            </td>
            <td>CRN008</td>
            <td>vikram.reddy@gmail.com</td>
            <td>Java Health Management System</td>
        </tr>
        <tr>
            <td class="name-cell">
                <div class="user-icon">
                    <i class="fa-solid fa-user"></i>
                </div>
                Priya Rajan
            </td>
            <td>CRN009</td>
            <td>priya.rajan@gmail.com</td>
            <td>Java Hotel Reservation System</td>
        </tr>
     
    </tbody>
</table> 
 </div>
          <div class="project2">
            <h3>Project Choosen</h3>
            <div style="display: flex; flex-direction: row;">
            <div style="display: flex; flex-direction: column">
              <div style="width: 350px; height: 250px;">
              <canvas id="myChart4" width="100" height="100"></canvas></div>
               <script>
              document.addEventListener('DOMContentLoaded', function () {
      const projectCtx = document.getElementById('myChart4').getContext('2d');
      
      // Gauge Chart Text plugin block
      const gaugeChartText = {
        id: 'gaugeChartText',
        afterDatasetsDraw(chart, args, pluginOptions) {
          const { ctx, chartArea: { top, bottom, left, right, width, height } } = chart;

          ctx.save();
          const xcoor = chart.getDatasetMeta(0).data[0].x;
          const ycoor = chart.getDatasetMeta(0).data[0].y;
          const total = chart.data.datasets[0].data.reduce((a, b) => a + b, 0);

          ctx.fillStyle = '#FFF3E1';
          ctx.beginPath();
          ctx.arc(xcoor, ycoor, 75, 0, 2 * Math.PI);
          ctx.fill();


          ctx.fillStyle = '#000'; // Text color
          ctx.font = '22px sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText(total, xcoor, ycoor + 15);

          ctx.font = '22px sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText('Java', xcoor, ycoor - 15);
          
          ctx.restore();
        }
      };

      new Chart(projectCtx, {
        type: 'doughnut',
        data: {
          datasets: [{
            label: '# of Votes',
            data: [20, 12, 4, 4],
            borderWidth: 1,
            cutout: '85%',
            borderRadius: 20,
            offset: 1,
            circumference: 270,
            rotation: 225,
            backgroundColor: [
              '#C084FC',
              '#FCC573',
              '#C5E866',
              '#6BD096'
            ]
          }]
        },
        options: {
          aspectRatio: 1.5,
        },
        plugins: [gaugeChartText]
      });
    });
               </script>

           

              <p style="line-height: 25px">
                <strong>40%</strong> most of the Students choose the java <br />
                for their project
              </p>
            </div>
            <div>
              <div class="roww"> 
                <div class="smallcircle" style="background-color: #C084FC;"></div>
                <p>Java</p>
              </div>
              <div class="roww">
                <div class="smallcircle" style="background-color: #FCC573;"></div>
                <p>Python</p>
              </div>
              <div class="roww">
                <div class="smallcircle" style="background-color: #C5E866;"></div>
                <p>C Language</p>
              </div>
              <div class="roww">
                <div class="smallcircle" style="background-color: #6BD096;"></div>
                <p>C++</p>
              </div>
            </div>
          </div></div>
        </div>
        
      </div>-->

            <!---------------------Attendance------------->
            <div class="student-attendance post" id="student-attendance">
              <h3 class="f22 font600">Student Attendance</h3>
              
              <div class="section">
                <div
                  class="sattendance-topnav"
                  style="margin-top: 20px; margin-bottom: 10px"
                >
                  <div class="sattendance-links-container">
                    <a
                      href="#inactive-students-report"
                      class="active"
                      onclick="toggleAttendanceSection('sattendance-inactive-download' , this)"
                    >
                      <img
                        src="img/activity.png"
                        alt="activity"
                        style="width: 15px; height: 15px"
                      />
                      <span>Summary</span>
                    </a>
                   
                    <a
                      href="#attendance-report"
                      onclick="toggleAttendanceSection('sattendance-report', this)"
                    >
                      <img
                        src="img/candidates.png"
                        alt="report"
                        style="width: 16px; height: 16px; padding-left: 5px"
                      />
                      <span>Attendance Report</span>
                    </a>
                    <a
                      href="#inactive-students"
                      onclick="toggleAttendanceSection('sattendance-inactive' , this)"
                    >
                      <img
                        src="img/activity.png"
                        alt="activity"
                        style="width: 15px; height: 15px"
                      />
                      <span>Inactive Students</span>
                    </a>

                    
                  </div>
                </div>
                <div class="sattendance " id="sattendance-summary">
                  <div class="stuattend">
                    <div class="stuattend-left-card1">
                      <canvas
                        id="stuattend-dailyTestChart"
                        width="200"
                        height="200"
                      ></canvas>
                      <div
                        style="
                          display: flex;
                          flex-direction: row;
                          justify-content: space-between;
                          padding: 0 20px;
                        "
                      >
                        <div class="stuattend-legend">
                          <span class="stuattend-legend-color"></span>
                          Events
                        </div>
                      </div>
                    </div>
                    <div class="stuattend-right-card1">
                      <h3 style="padding-top: 20px; text-align: center">
                        Summary Data Table
                      </h3>
                      <div id="stu_attend_result"></div>
                      <div class="stuattend-tablecontainer4"></div>
                    </div>
                  </div>
                </div>

                <div id="shimmer-student-attendance">
                  <%- include('shimmerTable') %>
                </div>

                <div class="sattendance" id="sattendance-report">
                  <div class="download-data-div" id="download-attendance-report" style="margin-bottom: 20px;">
                    <a href="#" class="download-btn" onclick="exportDataToCSV()" disabled>Download</a>
                  </div>
                  <div class="attendreportcontainer">
                    <div id="no-data-message-report" style="display: none; text-align: center">
                      <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                        <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                        <p style="font-size:16px;line-height:24px;">No Details Found</p>
                    </div>
                    </div>
                    <table>
                      <tbody class="attendreporttable"></tbody>
                    </table>
                  </div>
                
                  <!-- Pagination Controls -->
                  <div class="pagination" id="attendance-report-pagination" style="display: none; text-align: center; margin-top: 20px;">
                    <button id="attendance-report-prev" disabled onclick="prevAttendancePage()">Previous</button>
                    <div id="attendance-report-page-numbers" ></div>
                    <button id="attendance-report-next" disabled onclick="nextAttendancePage()">Next</button>
                  </div>
                </div>
                

                <div class="sattendance" id="sattendance-inactive">
                  <div class="download-data-div" style="margin-bottom: 20px;" id="download-session-inactive-students">
                    <a href="#" class="download-btn" onclick="downloadCSV('session_inactive_students')">Download</a>
                  </div>
                  <div id="no-data-message" style="text-align: center"></div>
                  <div class="inactiveAttendance-table-attendance dt-tablecontainer2">
                    <table>
                      <thead id="inactiveAttendance-table-header">
                        <tr >
                          <th>Name</th>
                          <th>College Roll Number</th>
                          <th>Email</th>
                          <th>Response</th>
                        </tr>
                      </thead>
                      <tbody id="inactiveAttendance-table-body"></tbody>
                    </table>
                  </div>
                  <div id="pagination-container" class="pagination">
                    <!-- Page numbers will be generated here dynamically -->
                  </div>
                  
                </div>
                

                <div class="sattendance active" id="sattendance-inactive-download">
                  <div id="event-download-result" style="display: none"></div>
                  <div id="nodata-div-summary2" style="display: none;">
                    <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                      <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;" />
                      <p style="font-size:16px;line-height:24px;">Attendance summary is currently unavailable</p>
                    </div>
                  </div>
                  <div class="inactive-table">
                    <table id="attendance-table">
                      <thead style="opacity: 0;" id="summary2-table-head">
                        <tr>
                          <th>Event Title</th>
                          <th>Total Students</th>
                          <th>Present Students</th>
                          <th>Absent Students</th>
                          <th>Hours Covered</th>
                          <th>Attendance Rate (%)</th>
                          <th>Average Feedback</th>
                          <th>Interactiveness (%)</th>
                          <th>Actions</th>
                          <th>Feedback</th>
                        </tr>
                      </thead>
                      <tbody id="attendance-data">
                        <!-- Event data will be inserted here by JavaScript -->
                      </tbody>
                    </table>
                  </div>
                  <div class="pagination" id="attendance-pagination-controls">
                    <button id="attendance-prevPage" onclick="attendancePrevPage()" style="font-size: 14px">Previous</button>
                    <div id="attendance-pageNumbers"></div>
                    <button id="attendance-nextPage" onclick="attendanceNextPage()" style="font-size: 14px">Next</button>
                  </div>
                </div>
                
              </div>
            </div>


             <!--------------------------Enrolled Candidates Section--------------------------------->
            

             <div class="enrolled-candidates post" id="candidates">

              <div style="display: flex;flex-direction: row;justify-content: space-between;">
                <h3 class="f22 font600">Enrolled Candidates</h3>
                  <div class="download-data-div" style="height: 40px;" id="enrolled-candidates-download">
                    <a href="#" class="download-btn" onclick="downloadCSV('enrolled_students')">Download</a>
                  </div>
              </div>
              

              <div id="shimmer-enrolled-candidates">
                <%- include('shimmerTable') %>
              </div>

              
              <div class="section">
                <div id="nodata-div-enrolled-students" style="display: none;">
                <div style="display:flex;flex-direction:column;gap:10px;justify-content:center;align-items:center;height:50vh;">
                  <img src="/img/noDataFoundImage.webp" alt="not-found-image" style="height:200px;width:200px;"/>
                  <p style="font-size:16px;line-height:24px;">No Details Found</p>
                </div>
              </div>
              <div style="margin-top: 40px;">
                <li class="table-header" id="enrolled-candidates-header" style="opacity: 0;display: none;">
                  <div class="col col-1">Basic Info</div>
                  <div class="col col-2">Batch Name</div>
                  <div class="col col-3">Employability Band</div>
                  <div class="col col-4">Employability Score</div>
                  <div class="col col-5">Enrolled Date</div>
                </li>
                <ul class="responsive-table" id="candidates-table"></ul>
              </div>
                <div class="pagination" id="pagination-ctrl">
                  <button id="prevPagee" onclick="goToPrevPage()">
                    Previous
                  </button>
                  <div id="pageNos"></div>
                  <button id="nextPagee" onclick="goToNextPage()">Next</button>
                </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>
    </div>
    <script>
      let phaseId;

      async function fetchPhaseDetails() {
        const urlParams = new URLSearchParams(window.location.search);
        phaseId = urlParams.get("phase_id");

        if (!phaseId) {
          document.getElementById("phase-title").textContent =
            "Invalid phase ID";
          return;
        }

        try {
          const response = await fetch(
            `/api/training_phase_analysis/phase_details/${phaseId}`
          );
          if (response.status !== 200) {
            document.getElementById("phase-title").textContent =
              "Error fetching phase details";
            return;
          }

          const phase = await response.json();
          renderPhaseDetails(phase);
        } catch (error) {
          console.error("Error fetching phase details:", error);
          document.getElementById("phase-title").textContent =
            "Error fetching phase details";
        }

        // Call the function to fetch and display session data
          fetchSessionData(phaseId);
        fetchLiveSessionTopData(phaseId);
        // Call the second fetch with phaseId
        fetchEnrolledStudents(phaseId);
        fetchEmployabilityGraphData(phaseId);
        // Call the function with the phase ID
        fetchAttendanceGraphData(phaseId);
        fetchAttendanceReportData(phaseId)
        fetchAttendanceData(phaseId);
        fetchDailyTestData(phaseId);
        fetchAttendanceDataAndUpdateChart(phaseId);
        fetchGrandTestData(phaseId);
        fetchWeeklyTestData(phaseId);
        loadEmployabilityStudentsData(phaseId, 1, 10);
        // Call the function to fetch inactive students
        fetchInactiveAttendanceStudents(phaseId);
      }

      function renderPhaseDetails(phase) {
        document.getElementById("phase-title").textContent = phase.title;
        document.getElementById("title").textContent = phase.title;
      }

      
      function fetchLiveSessionTopData(phaseId) {
  fetch(`/api/training_phase_analysis/live_sessions_topdata/${phaseId}`)
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then((data) => {
      // Update the UI with the fetched data
      document.getElementById("live-session-count").textContent =
        data.number_of_live_sessions;
      document.getElementById("overall-feedback").textContent =
        `${data.average_feedback} / 5`;
      document.getElementById("session-interactiveness").textContent =
        `${data.avg_interactiveness_percentage} / 100`;
     
      document.getElementById("hours-covered").textContent =
        data.total_hours;
    })
    .catch((error) => {
      console.error("Error fetching live session top data:", error);
      // You can add more error handling logic here, such as displaying an error message in the UI
      document.getElementById("error-message").textContent = 
        "Failed to load live session data. Please try again later.";
    });
}


function fetchAttendanceGraphData(phaseId) {
    fetch(`/api/training_phase_analysis/assessment_graph_details/${phaseId}`)
        .then((response) => response.json())
        .then((data) => {
            // Use || 0 to handle null values
            const dailyTests = parseInt(data.daily_tests) || 0;
            const assignments = parseInt(data.assignments) || 0;
            const grandTests = parseInt(data.grand_tests) || 0;

            document.getElementById("a-assessments").textContent = dailyTests + assignments + grandTests;
            document.getElementById("a-dailyTests").textContent = dailyTests;
            document.getElementById("a-assignments").textContent = assignments;
            document.getElementById("a-grandTests").textContent = grandTests;

            const assessmentLabels = ["Daily Test", "Assignments", "Grand Test"];
            const assessmentData = [dailyTests, assignments, grandTests];

            // Update the chart with the new data
            const assessmentChart = new Chart(
                document.getElementById("myChart-assessment").getContext("2d"),
                {
                    type: "doughnut",
                    data: {
                        labels: assessmentLabels,
                        datasets: [
                            {
                                data: assessmentData,
                                backgroundColor: ["#FB923C", "#C084FC", "#CCF6A4"],
                                borderWidth: 1,
                            },
                        ],
                    },
                    options: {
                        cutout: "70%", // Adjust the size of the center hole
                        plugins: {
                            legend: {
                                display: false,
                            },
                        },
                        responsive: true,
                        maintainAspectRatio: false,
                    },
                    plugins: [
                        {
                            id: "labelInsidePlugin",
                            afterDatasetsDraw(chart) {
                                const {
                                    ctx,
                                    chartArea: { width, height },
                                } = chart;
                                const centerX = width / 2;
                                const centerY = height / 2;
                                const totalValue = assessmentData.reduce(
                                    (total, value) => total + value,
                                    0
                                );
                                ctx.save();
                                ctx.textAlign = "center";
                                ctx.textBaseline = "middle";
                                ctx.font = "bold 16px Arial";
                                ctx.fillStyle = "#000";
                                ctx.fillText(`Total: ${totalValue}`, centerX, centerY);
                                ctx.restore();
                            },
                        },
                    ],
                }
            );
        })
        .catch((error) => {
            console.error("Error fetching assessment graph details:", error);
        });
}


      // Overview - employability
let employability_labels = [];
let employability_data = [];
let emp_data2 = [];

const employability_color = "#2563EB";
const employability_colors = "#FB923C";

const employability_ctx = document
  .getElementById("myChart-employability")
  .getContext("2d");

// Define employability_myChart globally
let employability_myChart;

function updateChart() {
  if (employability_labels.length === 0) {
    // No data available, hide canvas, show error message
    document.getElementById("myChart-employability").style.display = "none";
    document.getElementById("chart-error-message").style.display = "block";
  } else {
    // Data available, show canvas, hide error message
    document.getElementById("myChart-employability").style.display = "block";
    document.getElementById("chart-error-message").style.display = "none";

    // Initialize the chart if it doesn't exist
    if (!employability_myChart) {
      employability_myChart = new Chart(employability_ctx, {
        type: "bar",
        data: {
          labels: employability_labels,
          datasets: [
            {
              label: "Average Emp Test",
              data: employability_data,
              backgroundColor: employability_color,
              borderRadius: Number.MAX_VALUE,
              borderWidth: 0,
              borderSkipped: false,
              barThickness: 15,
            },
            {
              label: "Students Attempted",
              data: emp_data2,
              backgroundColor: employability_colors,
              borderRadius: Number.MAX_VALUE,
              borderWidth: 0,
              borderSkipped: false,
              barThickness: 15,
            },
          ],
        },
        options: {
          scales: {
            y: {
              ticks: {
                beginAtZero: true,
                stepSize: 100, // Step size for y-axis
                max: 400, // Maximum value for y-axis
              },
              grid: {
                display: true,
              },
            },
            x: {
              barPercentage: 0.5, // Adjust the width of the bars
              categoryPercentage: 1.0, // Adjust the space between the bars
              grid: {
                display: false,
              },
            },
          },
          plugins: {
            legend: {
              display: true,
              position: "top",
              clickable: false,
              labels: {
                color: "rgba(0,0,0,0.7)",
                padding: 15,
                usePointStyle: true,
                pointStyle: "rectRounded",
              },
            },
            tooltip: {
              enabled: false,
            },
          },
          interaction: {
            mode: "nearest",
            intersect: false,
            enabled: false,
          },
          responsive: true,
          maintainAspectRatio: false,
        },
      });
    } else {
      // If the chart already exists, update it with the new data
      employability_myChart.data.labels = employability_labels;
      employability_myChart.data.datasets[0].data = employability_data;
      employability_myChart.data.datasets[1].data = emp_data2;
      employability_myChart.update();
    }
  }
}

async function fetchEmployabilityGraphData(phaseId) {
  const apiUrl = `api/training_phase_analysis/employability_graph_details/${phaseId}`;

  try {
    const response = await fetch(apiUrl);
    if (response.status !== 200) {
      document.getElementById("myChart-employability").style.display = "none";
      document.getElementById("chart-error-message").style.display = "block";      return;
    }

    const data = await response.json();
    employability_labels = data.map((item) => item.title);
    employability_data = data.map((item) => item.average_100_equivalent_score);
    emp_data2 = data.map((item) => item.students_attempted);

    // Update the chart with the new data
    updateChart();

    const testCount = data.length;
    document.getElementById("employability_count").textContent = testCount;
  } catch (error) {
    console.error("Error fetching employability graph data:", error);
  }
}





fetchEmployabilityGraphData(phaseId); // Call the function with the appropriate phaseId
    
// Fetching session syllabus data from the backend
// Fetching session syllabus data from the backend


async function fetchSessionData(phaseId) {


    try {
        // Ensure phaseId is provided
        if (!phaseId) {
            console.error('Error: phaseId is required.');
            return;
        }

        // Send the phaseId as a query parameter in the URL
        const response = await fetch(`/api/training_phase_analysis/liveSessions_syllabus/${phaseId}`);
        const sessionData = await response.json();

        // Reference the table body
        const tableBody = document.querySelector('#livesession-syllabusTable tbody');

        // Clear any existing rows in the table body
        tableBody.innerHTML = '';

        if (sessionData.length === 0) {
            // If there is no data, show dummy data with overlay message
            const row = document.createElement('tr');
            const cell = document.createElement('td');
            cell.colSpan = 4; // Adjust based on the number of columns in your table
            cell.textContent = 'Data is not yet available';
            cell.style.color = 'gray';
            cell.style.textAlign = 'center';
            row.appendChild(cell);
            document.getElementById("livesession-syllabusTable-noData").style.display = "block";
            document.getElementById("shimmerTableCont").style.display = "none";

            tableBody.appendChild(row);
            return; // Exit the function as there's no data to process
        }

        // Loop through the data and add rows to the table
        sessionData.forEach(session => {
            const row = document.createElement('tr');

            // Event title column
            const eventIdCell = document.createElement('td');
            eventIdCell.textContent = session.event_title;
            eventIdCell.style.textAlign = 'left';
            row.appendChild(eventIdCell);

            // Faculty name column
            const facultyNameCell = document.createElement('td');
            facultyNameCell.textContent = session.name;
            row.appendChild(facultyNameCell);

            // Session details column
            const sessionDetailsCell = document.createElement('td');
            if (session.session_details) {
                sessionDetailsCell.textContent = session.session_details;
            } else {
                sessionDetailsCell.textContent = 'No data available';
                sessionDetailsCell.style.color = 'gray'; // Set text color to gray
            }
            row.appendChild(sessionDetailsCell);

            // Session materials column
            const sessionMaterialsCell = document.createElement('td');
            if (session.session_materials) {
                const materialLink = document.createElement('a');
                materialLink.href = session.session_materials;
                materialLink.textContent = 'View Materials';
                materialLink.target = '_blank'; // Open the link in a new tab
                sessionMaterialsCell.appendChild(materialLink);
            } else {
                sessionMaterialsCell.textContent = 'No data available';
                sessionMaterialsCell.style.color = 'gray'; // Set text color to gray
            }
            row.appendChild(sessionMaterialsCell);

            // Append the row to the table body
            tableBody.appendChild(row);
        });

        // Hide shimmer loading container after data is loaded
        document.getElementById("shimmerTableCont").style.display = "none";

    } catch (error) {
        console.error('Error fetching session data:', error);
        document.getElementById("livesession-syllabusTable-noData").style.display = "block";
        document.getElementById("shimmerTableCont").style.display = "none";
    }
}

// Example: Call the function to fetch and display session data with a valid phaseId
fetchSessionData();




let totalPages;
      let current = 1;
      const pageSize = 10;
      let data = [];

      function fetchEnrolledStudents(phaseId) {
        fetch(`/api/training_phase_analysis/enrolled_students/${phaseId}`)
          
          .then((response) => response.json())
          .then((fetchedData) => {
            document.getElementById("shimmer-enrolled-candidates").style.display = "none";
            document.getElementById("enrolled-candidates-header").style.opacity = "1"; 

            data = fetchedData;

            if(data.length===1){
              document.getElementById("nodata-div-enrolled-students").style.display = "block";
              
            }
            totalPages = Math.ceil(data.length / pageSize);
            current = 1;

            updateEnrolledPaginationControls();
            renderTable();
          })
          .catch((error) => {
            console.error("Error fetching enrolled students:", error);
            document.getElementById("shimmer-enrolled-candidates").style.display = "none";
            document.getElementById("enrolled-candidates-download").style.display = "none";
            document.getElementById("nodata-div-enrolled-students").style.display = "block";
          });
      }

      function goToPrevPage() {
        if (current > 1) {
          current--;
          updateEnrolledPaginationControls();
          renderTable();
        }
      }

      function goToNextPage() {
        if (current < totalPages) {
          current++;
          updateEnrolledPaginationControls();
          renderTable();
        }
      }

      function updateEnrolledPaginationControls() {
        const prevPageButton = document.getElementById("prevPagee");
        const nextPageButton = document.getElementById("nextPagee");
        const pageNumbersDiv = document.getElementById("pageNos");

        prevPageButton.disabled = current === 1;
        nextPageButton.disabled = current === totalPages;

        pageNumbersDiv.innerHTML = "";

        let startPage = Math.max(1, current - 3);
        let endPage = Math.min(totalPages, current + 3);

        if (endPage - startPage < 6) {
          if (startPage === 1) {
            endPage = Math.min(startPage + 6, totalPages);
          } else {
            startPage = Math.max(endPage - 6, 1);
          }
        }

        for (let page = startPage; page <= endPage; page++) {
          const pageButton = document.createElement("span");
          pageButton.textContent = page;
          pageButton.className = "page-btn";
          if (page === current) {
            pageButton.classList.add("active");
          }
          pageButton.addEventListener("click", () => {
            current = page;
            updateEnrolledPaginationControls();
            renderTable();
          });
          pageNumbersDiv.appendChild(pageButton);
        }
      }

      function renderTable() {
        const startIndex = (current - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, data.length);

        const tableRows = data
          .slice(startIndex, endIndex)
          .map((student, index) => {
            const serialNumber = startIndex + index + 1;

            return `
      <li class="table-row">
        <div class="col col-1" data-label="Basic Info">
          <div style="display: flex; align-items: center">
            <div style="display: flex; align-items: center">
              <p style="margin-right: 10px">${serialNumber}</p>
              <img src="${
                student.image ? student.image : "img/sidebar logo.png"
              }" alt="User Image" style="width: 50px; height: 50px; border-radius: 50%; margin-right: 10px;" />
            </div>
            <div>
              <p class="emp-name">${student.name}</p>
              <p class="emp-email">${student.email}</p>
            </div>
          </div>
        </div>
        <div class="col col-2" data-label="Domain">${student.title}</div>
        <div class="col col-3" data-label="Employability Band">${
          student.employability_band
        }</div>
        <div class="col col-4" data-label="Employability Score">${
          student.emp_score
        }</div>
        <div class="col col-5" data-label="Enrolled Date">${new Date(
          student.start_date
        ).toLocaleDateString()}</div>
      </li>
    `;
          });

        const candidatesTable = document.getElementById("candidates-table");
        candidatesTable.innerHTML = tableRows.join("");
      }

      const attendReportContainer = document.querySelector(".attendreportcontainer");
const attendReportTable = document.querySelector(".attendreporttable");
const noDataMessage = document.getElementById("no-data-message-report");
const paginationContainer = document.getElementById("attendance-report-pagination");
const prevButton = document.getElementById("attendance-report-prev");
const nextButton = document.getElementById("attendance-report-next");
const pageNumbersContainer = document.getElementById("attendance-report-page-numbers");
const downloadAttendanceReport = document.getElementById("download-attendance-report");

let currentAttendancePage = 1;
let rowsAttendancePerPage = 10;
let totalAttendancePages = 0;
let trainingAttendanceData = []; // To store fetched data globally

// Fetch data from API and store it in a global variable
async function fetchAttendanceReportData(phaseId) {
  try {
    const response = await fetch(`/api/training_phase_analysis/data/${phaseId}`);
    const data = await response.json();


    if (!data || data.length === 0) {
      noDataMessage.style.display = "block";
      attendReportTable.style.display = "none";
      paginationContainer.style.display = "none";
      downloadAttendanceReport.style.display = "none";
      document.querySelector(".download-btn").disabled = true; // Disable download button
    } else {
      noDataMessage.style.display = "none";
      attendReportTable.style.display = "table-row-group";
      paginationContainer.style.display = "flex";
      trainingAttendanceData = data;
      totalAttendancePages = Math.ceil(trainingAttendanceData.length / rowsAttendancePerPage);
      updateAttendancePaginationControls();
      createAttendanceTable(trainingAttendanceData);
      document.querySelector(".download-btn").disabled = false; // Enable download button
    }
  } catch (error) {
    console.error("Error fetching data:", error);
    downloadAttendanceReport.style.display = "none";
    // noDataMessage.textContent = "Failed to fetch data. Please try again later.";
    noDataMessage.style.display = "block";
    paginationContainer.style.display = "none";
    document.querySelector(".download-btn").disabled = true; // Disable download button
  }
}

// Create table based on current page
function createAttendanceTable(data) {
  attendReportTable.innerHTML = "";
  
  const headerRow = document.createElement("tr");
  headerRow.className = "ar-table-header";
  
  const headers = Object.keys(data[0]);
  headers.forEach(header => {
    const headerCell = document.createElement("th");
    headerCell.textContent = header;
    headerRow.appendChild(headerCell);
  });
  
  attendReportTable.appendChild(headerRow);

  const startIndex = (currentAttendancePage - 1) * rowsAttendancePerPage;
  const endIndex = Math.min(startIndex + rowsAttendancePerPage, data.length);
  
  for (let i = startIndex; i < endIndex; i++) {
    const rowElement = document.createElement("tr");
    rowElement.className = "ar-table-row";
    
    Object.values(data[i]).forEach(cellValue => {
      const cellElement = document.createElement("td");
      cellElement.textContent = cellValue;
      rowElement.appendChild(cellElement);
    });
    
    attendReportTable.appendChild(rowElement);
  }
}

function updateAttendancePaginationControls() {
  prevButton.disabled = currentAttendancePage === 1;
  nextButton.disabled = currentAttendancePage === totalAttendancePages;

  pageNumbersContainer.innerHTML = "";

  // Determine the range of pages to display
  let startPage = Math.max(currentAttendancePage - 3, 1);
  let endPage = Math.min(startPage + 6, totalAttendancePages);

  if (endPage - startPage < 6) {
    startPage = Math.max(endPage - 6, 1);
  }

  // Add "1" and "..." if needed
  if (startPage > 1) {
    addPageButton(1);
    if (startPage > 2) {
      addEllipsis();
    }
  }

  // Display the range of pages
  for (let i = startPage; i <= endPage; i++) {
    addPageButton(i);
  }

  // Add "..." and last page if needed
  if (endPage < totalAttendancePages) {
    if (endPage < totalAttendancePages - 1) {
      addEllipsis();
    }
    addPageButton(totalAttendancePages);
  }
}

function addPageButton(pageNumber) {
  const pageButton = document.createElement("span");
  pageButton.textContent = pageNumber;
  pageButton.className = "pagenation-page";
  if (pageNumber === currentAttendancePage) {
    pageButton.classList.add("active");
  } else {
    pageButton.onclick = () => goToAttendancePage(pageNumber);
  }
  pageNumbersContainer.appendChild(pageButton);
}

function addEllipsis() {
  const ellipsis = document.createElement("span");
  ellipsis.textContent = "...";
  ellipsis.className = "ellipsis";
  pageNumbersContainer.appendChild(ellipsis);
}

// Go to a specific page
function goToAttendancePage(page) {
  currentAttendancePage = page;
  createAttendanceTable(trainingAttendanceData);
  updateAttendancePaginationControls();
}

// Move to the next page
function nextAttendancePage() {
  if (currentAttendancePage < totalAttendancePages) {
    currentAttendancePage++;
    createAttendanceTable(trainingAttendanceData);
    updateAttendancePaginationControls();
  }
}

// Move to the previous page
function prevAttendancePage() {
  if (currentAttendancePage > 1) {
    currentAttendancePage--;
    createAttendanceTable(trainingAttendanceData);
    updateAttendancePaginationControls();
  }
}


// Function to download CSV from the fetched data
function exportDataToCSV() {
  if (trainingAttendanceData && trainingAttendanceData.length > 0) {
    createAndDownloadCSV(trainingAttendanceData, 'attendance');
  } else {
    console.error("No data available to download.");
    alert("No data available to download. Please fetch data first.");
  }
}

function createAndDownloadCSV(data, filename) {
  if (!data || data.length === 0) {
    console.error("No data available for download.");
    return;
  }

  // Convert JSON data to CSV
  const csvData = convertToCSVFormat(data);
  
  // Add a BOM to ensure UTF-8 encoding is recognized by spreadsheet programs
  const bom = '\uFEFF';
  const csvBlob = new Blob([bom + csvData], { type: 'text/csv;charset=utf-8;' });

  // Create a temporary link to download the CSV file
  const downloadLink = document.createElement('a');
  downloadLink.href = URL.createObjectURL(csvBlob);
  downloadLink.setAttribute('download', `${filename}.csv`);
  document.body.appendChild(downloadLink);
  downloadLink.click();
  document.body.removeChild(downloadLink);
}

// Helper function to convert JSON data to CSV format
function convertToCSVFormat(data) {
  const headers = Object.keys(data[0]);
  const rows = data.map(row => headers.map(header => formatCSVField(row[header])).join(','));

  return [headers.join(','), ...rows].join('\n');
}

// Function to format each field for CSV
function formatCSVField(value) {
  if (typeof value === 'string') {
    // Escape double quotes and wrap fields with commas or newlines in double quotes
    if (value.includes(',') || value.includes('\n')) {
      return `"${value.replace(/"/g, '""')}"`;
    }
  }

  // Return correct symbols for tick and cross
  if (value === '' || value === '') {
    return value; // Already correct symbols
  }

  // Return empty string for undefined or null values
  return value ?? '';
}
 
      const rowsPerPage = 10;
      let currentPage = 1;
      let tableData = [];

      async function fetchDailyTestData(phaseId) {
        try {
          const response = await fetch(
            `/api/training_phase_analysis/daily_test/${phaseId}`
          );
          if (response.ok) {
            const data = await response.json();
            document.getElementById("shimmer-table-for-student-activity").style.display = "none";
            const hackathonTests = Object.keys(data[0].hackathon_scores);
            tableData = data.map((item) => {
              const hackathonScores = hackathonTests.map((test) =>
                item.hackathon_scores[test] !== undefined
                  ? item.hackathon_scores[test]
                  : "Absent"
              );
              return {
                ...item,
                ...Object.fromEntries(
                  hackathonTests.map((test, i) => [test, hackathonScores[i]])
                ),
              };
            });
            renderDailyTestData();

       
            updatePaginationControls();
            // Show/hide pagination based on data length
            const paginationControls = document.getElementById(
              "pagination-controls"
            );
            paginationControls.style.display =
              data.length > 10 ? "flex" : "none";
          } else {
            const errorResponse = await response.json();
            document.getElementById("shimmer-table-for-student-activity").style.display = "none";

            document.getElementById("daily-result-message").innerHTML =

            `
            <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                <p style="font-size:16px;line-heigth:24px;">The test has not been conducted yet, so there are no results to show. Please stay tuned for updates.</p>
            </div>
            
            `
              
            document.getElementById("daily-result-message").style.display =
              "block"; // Show error message
            document.getElementById("pagination-controls").style.display =
              "none"; // Hide pagination
            document.getElementById('daily-test-download').style.display = "none"//Hide Download Btn
            
          }
        } catch (error) {
          console.error("Error fetching daily test data:", error);
          document.getElementById('daily-test-download').style.display = "none"//Hide Download Btn
          document.getElementById("shimmer-table-for-student-activity").style.display = "none";
          document.getElementById("daily-result-message").innerHTML =

          `
            <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                <p style="font-size:16px;line-heigth:24px;">The test has not been conducted yet, so there are no results to show. Please stay tuned for updates.</p>
            </div>
          `

          document.getElementById("daily-result-message").style.display =
            "block"; // Show error message
          document.getElementById("pagination-controls").style.display = "none"; // Hide pagination
        }
      }

      function renderDailyTestData() {
        const tableBody = document.getElementById("dailytesttable-body");
        const tableHead = document.getElementById("dailytesttable-head");
        tableBody.innerHTML = "";
        tableHead.innerHTML = "";

        if (tableData.length === 0) {
          return;
        }

        const hackathonTests = Object.keys(tableData[0].hackathon_scores);

        function formatTestName(testName) {
          const keywords = ["Alpha", "Beta", "Gamma", "Delta"]; // Add more keywords as needed
          for (const keyword of keywords) {
            if (testName.includes(keyword)) {
              return testName.replace(keyword, `<br>${keyword}`);
            }
          }
          return testName;
        }

        const tableHeaderRow = document.createElement("tr");
        tableHeaderRow.innerHTML = `
    <th>S.No</th>
    <th>Name</th>
    <th>Email</th>
    <th>Registration No</th>
    <th>Average Score</th>
    ${hackathonTests.map((test) => `<th>${formatTestName(test)}</th>`).join("")}
  `;
        tableHead.appendChild(tableHeaderRow);

        const startIndex = (currentPage - 1) * rowsPerPage;
        const endIndex = Math.min(startIndex + rowsPerPage, tableData.length);

        for (let i = startIndex; i < endIndex; i++) {
          const row = tableData[i];
          const tableRow = document.createElement("tr");

          tableRow.innerHTML = `
      <td>${i + 1}</td>
      <td>${row.name}</td>
      <td>${row.email}</td>
      <td>${row.regno}</td>
      <td><span class="percentage">${row.test_score}%</span></td>
      ${hackathonTests
        .map((test) => {
          const score = row[test];
          const scoreClass = score === "Absent" ? ' class="absent"' : "";
          return `<td${scoreClass}>${score}</td>`;
        })
        .join("")}
    `;

          tableBody.appendChild(tableRow);
        }
      }

      function updatePaginationControls() {
        const pageNumbersElement = document.getElementById("pageNumbers");
        const prevPageButton = document.getElementById("prevPage");
        const nextPageButton = document.getElementById("nextPage");
        const totalPages = Math.ceil(tableData.length / rowsPerPage);

        pageNumbersElement.innerHTML = "";
        prevPageButton.disabled = currentPage === 1;
        nextPageButton.disabled = currentPage === totalPages;

        let startPage = Math.max(currentPage - 3, 1);
        let endPage = Math.min(currentPage + 3, totalPages);

        if (endPage - startPage < 6) {
          if (startPage === 1) {
            endPage = Math.min(startPage + 6, totalPages);
          } else if (endPage === totalPages) {
            startPage = Math.max(endPage - 6, 1);
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          const pageNumber = document.createElement("span");
          pageNumber.textContent = i;
          pageNumber.style.fontWeight = i === currentPage ? "bold" : "normal";
          pageNumber.style.backgroundColor =
            i === currentPage ? "#7962BD" : "#D3FB52";
          pageNumber.style.color = i === currentPage ? "#fff" : "#000";
          pageNumber.onclick = () => goToPage(i);
          pageNumbersElement.appendChild(pageNumber);
        }
      }

      function goToPage(page) {
        currentPage = page;
        renderDailyTestData();
        updatePaginationControls();
      }

      function prevPage() {
        if (currentPage > 1) {
          currentPage--;
          renderDailyTestData();
          updatePaginationControls();
        }
      }

      function nextPage() {
        const totalPages = Math.ceil(tableData.length / rowsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          renderDailyTestData();
          updatePaginationControls();
        }
      }

      async function fetchGrandTestData(phaseId) {
        try {
          const response = await fetch(
            `/api/training_phase_analysis/grand_test/${phaseId}`
          );
          if (response.ok) {
            const data = await response.json();

            document.getElementById("shimmer-table-for-student-activity").style.display = "none";

            const grandTestTitles = Object.keys(data[0].test_score);
            tableData = data.map((item) => {
              const grandTestScores = grandTestTitles.map((title) =>
                item.test_score[title] !== undefined
                  ? item.test_score[title]
                  : 0
              );
              return {
                ...item,
                ...Object.fromEntries(
                  grandTestTitles.map((title, i) => [title, grandTestScores[i]])
                ),
              };
            });
            renderGrandTestData();
            updateGrandPaginationControls();
          } else {
            const errorResponse = await response.json();
            document.getElementById("shimmer-table-for-student-activity").style.display = "none";

            document.getElementById("result-message").innerHTML =
            `
             <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                <p style="font-size:16px;line-heigth:24px;">${errorResponse.error}</p>
            </div>
            `
            ;
            document.getElementById("result-message").style.display = "block"; // Show error message
            document.getElementById("grand-pagination-controls").style.display =
              "none"; // Hide pagination

            document.getElementById("grand-test-download").style.display = "none";
            //Hide Download Button
          }
        } catch (error) {
          console.error("Error fetching grand test data:", error);
          document.getElementById("shimmer-table-for-student-activity").style.display = "none";

          document.getElementById("result-message").innerHTML =
            `
            <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                <p style="font-size:16px;line-heigth:24px;">${error}</p>
            </div>
            `
            ;
          document.getElementById("result-message").style.display = "block"; // Show error message
          document.getElementById("grand-pagination-controls").style.display =
            "none"; // Hide pagination
        }
      }

      function renderGrandTestData() {
        const tableBody = document.getElementById("grandtesttable-body");
        const tableHead = document.getElementById("grandtesttable-head");
        tableBody.innerHTML = "";
        tableHead.innerHTML = "";

        if (tableData.length === 0) {
          document.getElementById("result-message").innerHTML =
            "No data available.";
          document.getElementById("result-message").style.display = "block"; // Show error message
          document.getElementById("grand-pagination-controls").style.display =
            "none"; // Hide pagination
          return;
        } else {
          document.getElementById("result-message").style.display = "none"; // Hide error message
          document.getElementById("grand-pagination-controls").style.display =
            tableData.length > grandRowsPerPage ? "block" : "none"; // Show/hide pagination controls
        }

        const grandTestTitles = Object.keys(tableData[0].hackathon_scores);

        function formatTestName(testName) {
          const keywords = ["Alpha", "Beta", "Premium", "Delta"]; // Add more keywords as needed
          for (const keyword of keywords) {
            if (testName.includes(keyword)) {
              return testName.replace(keyword, `<br>${keyword}`);
            }
          }
          return testName;
        }

        const tableHeaderRow = document.createElement("tr");
        tableHeaderRow.innerHTML = `
    <th>S.No</th>
    <th>Name</th>
    <th>Email</th>
    <th>Registration No</th>
    <th>Average Score</th>
    ${grandTestTitles
      .map((title) => `<th>${formatTestName(title)}</th>`)
      .join("")}
  `;
        tableHead.appendChild(tableHeaderRow);

        const startIndex = (grandCurrentPage - 1) * grandRowsPerPage;
        const endIndex = Math.min(
          startIndex + grandRowsPerPage,
          tableData.length
        );

        for (let i = startIndex; i < endIndex; i++) {
          const row = tableData[i];
          const tableRow = document.createElement("tr");

          tableRow.innerHTML = `
      <td>${i + 1}</td>
      <td>${row.name}</td>
      <td>${row.email}</td>
      <td>${row.regno}</td>
      <td><span class="percentage">${row.test_score}%</span></td>
      ${grandTestTitles
        .map((title) => {
          const score = row[title];
          const scoreClass = score === 0 ? ' class="absent"' : "";
          return `<td${scoreClass}>${score}</td>`;
        })
        .join("")}
    `;

          tableBody.appendChild(tableRow);
        }

        updateGrandPaginationControls();
      }

      function updateGrandPaginationControls() {
        const paginationControls = document.getElementById(
          "grand-pagination-controls"
        );
        const pageNumbersElement = document.getElementById("grandpageNumbers");
        const prevPageButton = document.getElementById("grandprevPage");
        const nextPageButton = document.getElementById("grandnextPage");
        const totalPages = Math.ceil(tableData.length / grandRowsPerPage);

        if (totalPages > 1) {
          paginationControls.style.display = "block"; // Show pagination controls
        } else {
          paginationControls.style.display = "none"; // Hide pagination controls if not needed
        }

        pageNumbersElement.innerHTML = "";
        prevPageButton.disabled = grandCurrentPage === 1;
        nextPageButton.disabled = grandCurrentPage === totalPages;

        let startPage = Math.max(grandCurrentPage - 3, 1);
        let endPage = Math.min(grandCurrentPage + 3, totalPages);

        if (endPage - startPage < 6) {
          if (startPage === 1) {
            endPage = Math.min(startPage + 6, totalPages);
          } else if (endPage === totalPages) {
            startPage = Math.max(endPage - 6, 1);
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          const pageNumber = document.createElement("span");
          pageNumber.textContent = i;
          pageNumber.style.fontWeight =
            i === grandCurrentPage ? "bold" : "normal";
          pageNumber.style.backgroundColor =
            i === grandCurrentPage ? "#7962BD" : "#D3FB52";
          pageNumber.style.color = i === grandCurrentPage ? "#fff" : "#000";
          pageNumber.onclick = () => goToGrandPage(i);
          pageNumbersElement.appendChild(pageNumber);
        }
      }

      function grandPrevPage() {
        if (grandCurrentPage > 1) {
          grandCurrentPage--;
          renderGrandTestData();
        }
      }

      function grandNextPage() {
        const totalPages = Math.ceil(tableData.length / grandRowsPerPage);
        if (grandCurrentPage < totalPages) {
          grandCurrentPage++;
          renderGrandTestData();
        }
      }

      function goToGrandPage(page) {
        grandCurrentPage = page;
        renderGrandTestData();
      }

      async function fetchWeeklyTestData(phaseId) {
        try {
          document
          const response = await fetch(
            `/api/training_phase_analysis/weekly_test/${phaseId}`
          );
          if (response.ok) {
            const data = await response.json();
            document.getElementById("shimmer-table-for-student-activity").style.display = "none";
            const weeklyTestTitles = Object.keys(data[0].test_score);
            tableData = data.map((item) => {
              const weeklyTestScores = weeklyTestTitles.map((title) =>
                item.test_score[title] !== undefined
                  ? item.test_score[title]
                  : 0
              );
              return {
                ...item,
                ...Object.fromEntries(
                  weeklyTestTitles.map((title, i) => [
                    title,
                    weeklyTestScores[i],
                  ])
                ),
              };
            });
            renderWeeklyTestData();
            updateWeeklyPaginationControls();
          } else {
            const errorResponse = await response.json();
            document.getElementById("shimmer-table-for-student-activity").style.display = "none";

            document.getElementById("weekly-result-message").innerHTML =
            `
            <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                <p style="font-size:16px;line-heigth:24px;">${errorResponse.error}</p>
            </div>
            `
            ;
            document.getElementById("weekly-result-message").style.display =
              "block"; // Show error message
            document.getElementById(
              "weekly-pagination-controls"
            ).style.display = "none"; // Hide pagination
          }
        } catch (error) {
          console.error("Error fetching weekly test data:", error);
          document.getElementById("weekly-result-message").innerHTML =
          `  
          <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
                <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
                <p style="font-size:16px;line-heigth:24px;">${error}</p>
            </div>
          `
          ;
          document.getElementById("weekly-result-message").style.display =
            "block"; // Show error message
          document.getElementById("weekly-pagination-controls").style.display =
            "none"; // Hide pagination
        }
      }

      function renderWeeklyTestData() {
        const tableBody = document.getElementById("weeklytesttable-body");
        const tableHead = document.getElementById("weeklytesttable-head");
        tableBody.innerHTML = "";
        tableHead.innerHTML = "";
        let weeklyCurrentPage = 1;
        let weeklyRowsPerPage = 10;

        if (tableData.length === 0) {
          return;
        }

        const weeklyTestTitles = Object.keys(tableData[0].hackathon_scores);

        function formatTestName(testName) {
          const keywords = ["Alpha", "Beta", "Premium", "Delta"]; // Add more keywords as needed
          for (const keyword of keywords) {
            if (testName.includes(keyword)) {
              return testName.replace(keyword, `<br>${keyword}`);
            }
          }
          return testName;
        }

        const tableHeaderRow = document.createElement("tr");
        tableHeaderRow.innerHTML = `
    <th>S.No</th>
    <th>Name</th>
    <th>Email</th>
    <th>Registration No</th>
    <th>Average Score</th>
    ${weeklyTestTitles
      .map((title) => `<th>${formatTestName(title)}</th>`)
      .join("")}
  `;
        tableHead.appendChild(tableHeaderRow);

        const startIndex = (weeklyCurrentPage - 1) * weeklyRowsPerPage;
        const endIndex = Math.min(
          startIndex + weeklyRowsPerPage,
          tableData.length
        );

        for (let i = startIndex; i < endIndex; i++) {
          const row = tableData[i];
          const tableRow = document.createElement("tr");

          tableRow.innerHTML = `
      <td>${i + 1}</td>
      <td>${row.name}</td>
      <td>${row.email}</td>
      <td>${row.regno}</td>
      <td><span class="percentage">${row.test_score}%</span></td>
      ${weeklyTestTitles
        .map((title) => {
          const score = row[title];
          const scoreClass = score === 0 ? ' class="absent"' : "";
          return `<td${scoreClass}>${score}</td>`;
        })
        .join("")}
    `;

          tableBody.appendChild(tableRow);
        }

        updateWeeklyPaginationControls();
      }

      function updateWeeklyPaginationControls() {
        const paginationControls = document.getElementById(
          "weekly-pagination-controls"
        );
        const pageNumbersElement = document.getElementById("weeklypageNumbers");
        const prevPageButton = document.getElementById("weeklyprevPage");
        const nextPageButton = document.getElementById("weeklynextPage");
        const totalPages = Math.ceil(tableData.length / weeklyRowsPerPage);

        if (totalPages > 1) {
          paginationControls.style.display = "block"; // Show pagination controls
        } else {
          paginationControls.style.display = "none"; // Hide pagination controls if not needed
        }

        pageNumbersElement.innerHTML = "";
        prevPageButton.disabled = weeklyCurrentPage === 1;
        nextPageButton.disabled = weeklyCurrentPage === totalPages;

        let startPage = Math.max(weeklyCurrentPage - 3, 1);
        let endPage = Math.min(weeklyCurrentPage + 3, totalPages);

        if (endPage - startPage < 6) {
          if (startPage === 1) {
            endPage = Math.min(startPage + 6, totalPages);
          } else if (endPage === totalPages) {
            startPage = Math.max(endPage - 6, 1);
          }
        }

        for (let i = startPage; i <= endPage; i++) {
          const pageNumber = document.createElement("span");
          pageNumber.textContent = i;
          pageNumber.style.fontWeight =
            i === weeklyCurrentPage ? "bold" : "normal";
          pageNumber.style.backgroundColor =
            i === weeklyCurrentPage ? "#7962BD" : "#D3FB52";
          pageNumber.style.color = i === weeklyCurrentPage ? "#fff" : "#000";
          pageNumber.onclick = () => goToWeeklyPage(i);
          pageNumbersElement.appendChild(pageNumber);
        }
      }

      function weeklyPrevPage() {
        if (weeklyCurrentPage > 1) {
          weeklyCurrentPage--;
          renderWeeklyTestData();
        }
      }

      function weeklyNextPage() {
        const totalPages = Math.ceil(tableData.length / weeklyRowsPerPage);
        if (weeklyCurrentPage < totalPages) {
          weeklyCurrentPage++;
          renderWeeklyTestData();
        }
      }

      function goToWeeklyPage(page) {
        weeklyCurrentPage = page;
        renderWeeklyTestData();
      }

      let currentEmpPage = 1; // Store the current page number globally
let totalEmpPages = 0;  // Store the total number of pages globally

async function loadEmployabilityStudentsData(phaseId, page = 1, pageSize = 10) {
  try {
    const response = await fetch(
      `/api/training_phase_analysis/employability_students_data/${phaseId}`
    );
    const data = await response.json();

    if (data.length === 0) {
      document.getElementById("emp-result-message").innerHTML =
        "<p>No data available</p>";
      document.getElementById("emppageNumbers").innerHTML = "";
      document.getElementById("empprevPage").disabled = true;
      document.getElementById("empnextPage").disabled = true;
      document.getElementById("emp-pagination-controls").style.display =
        "none";
        document.getElementById("shimmer-table-for-student-activity").style.display = "none";

      return;
    }

    // Extract distinct hackathon score titles
    const hackathonTitles = new Set();
    data.forEach((student) => {
      for (const title in student.hackathon_scores) {
        hackathonTitles.add(title);
      }
    });

    // Slice the data array based on the current page and page size
    const startIndex = (page - 1) * pageSize;
    const endIndex = startIndex + pageSize;
    const pagedData = data.slice(startIndex, endIndex);

    const tableHead = document.getElementById("emptesttable-head");
    const tableBody = document.getElementById("emptesttable-body");

    // Clear previous table headers and body
    tableHead.innerHTML = "";
    tableBody.innerHTML = "";

    // Create table headers
    const headerRow = document.createElement("tr");
    ["Name", "Email", "Registration No", "Average Score"].forEach((text) => {
      const th = document.createElement("th");
      const headerText = document.createElement("div");
      headerText.innerText = text;
      th.appendChild(headerText);
      headerRow.appendChild(th);
    });
    hackathonTitles.forEach((title) => {
      const th = document.createElement("th");
      const headerText = document.createElement("div");
      const index = title.indexOf("Employability Test");
      if (index !== -1) {
        const beforeText = title.substring(0, index);
        const afterText = title.substring(index);
        headerText.innerHTML = `${beforeText}<br>${afterText}`;
      } else {
        headerText.innerText = title;
      }
      th.appendChild(headerText);
      headerRow.appendChild(th);
    });
    tableHead.appendChild(headerRow);

    // Create table rows
    pagedData.forEach((student) => {
      const row = document.createElement("tr");
      ["name", "email", "regno", "test_score"].forEach((key) => {
        const td = document.createElement("td");
        td.innerText = student[key];
        row.appendChild(td);
      });
      hackathonTitles.forEach((title) => {
        const td = document.createElement("td");
        td.innerText = student.hackathon_scores[title] || 0;
        row.appendChild(td);
      });
      tableBody.appendChild(row);
    });

    // Update the pagination controls
    totalEmpPages = Math.ceil(data.length / pageSize);
    const pageNumbers = document.getElementById("emppageNumbers");
    pageNumbers.innerHTML = "";

    const maxVisiblePages = 7;
    let startPage = Math.max(1, page - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalEmpPages, startPage + maxVisiblePages - 1);

    if (endPage - startPage < maxVisiblePages - 1) {
      startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }

    if (startPage > 1) {
      const firstPage = document.createElement("span");
      firstPage.innerText = "1";
      firstPage.onclick = () =>
        loadEmployabilityStudentsData(phaseId, 1, pageSize);
      pageNumbers.appendChild(firstPage);

      if (startPage > 2) {
        const dots = document.createElement("span");
        dots.innerText = "...";
        pageNumbers.appendChild(dots);
      }
    }

    for (let i = startPage; i <= endPage; i++) {
      const pageNumber = document.createElement("span");
      pageNumber.innerText = i;
      pageNumber.onclick = () => loadEmployabilityStudentsData(phaseId, i, pageSize);
      if (i === page) {
        pageNumber.classList.add("active");
      }
      pageNumbers.appendChild(pageNumber);
    }

    if (endPage < totalEmpPages) {
      if (endPage < totalEmpPages - 1) {
        const dots = document.createElement("span");
        dots.innerText = "...";
        pageNumbers.appendChild(dots);
      }

      const lastPage = document.createElement("span");
      lastPage.innerText = totalEmpPages;
      lastPage.onclick = () =>
        loadEmployabilityStudentsData(phaseId, totalEmpPages, pageSize);
      pageNumbers.appendChild(lastPage);
    }

    // Enable/disable previous and next buttons based on current page
    document.getElementById("empprevPage").disabled = page === 1;
    document.getElementById("empnextPage").disabled = page === totalEmpPages;

    // Show pagination controls
    document.getElementById("emp-pagination-controls").style.display = "flex";

    // Update current page
    currentEmpPage = page;
  } catch (error) {
    document.getElementById("shimmer-table-for-student-activity").style.display = "none";

    console.error("Error loading employability students data:", error);
    document.getElementById("emp-result-message").innerHTML =
      `
      <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
          <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
          <p style="font-size:16px;line-heigth:24px;">The test has not been conducted yet, so there are no results to show. <br/> Please stay tuned for updates</p>
      </div>
      
      `
      ;
    document.getElementById("emp-result-message").style.display = "block";
    document.getElementById("emp-pagination-controls").style.display = "none";
    document.getElementById("employability-test-download").style.display = "none";
  }
}

// Hook up the Previous and Next buttons
document.getElementById("empprevPage").addEventListener("click", () => {
  if (currentEmpPage > 1) {
    loadEmployabilityStudentsData(phaseId, currentEmpPage - 1);
  }
});

document.getElementById("empnextPage").addEventListener("click", () => {
  if (currentEmpPage < totalEmpPages) {
    loadEmployabilityStudentsData(phaseId, currentEmpPage + 1);
  }
});


async function fetchAttendanceData(phaseId) {
        try {
          const response = await fetch(
            `/api/training_phase_analysis/attendance_count/${phaseId}`
          );
          const data = await response.json();

          const tableContainer = document.querySelector(
            ".stuattend-tablecontainer4"
          );

          if (!data || data.length === 0) {
            tableContainer.innerHTML = "<p>No data available</p>";
            return;
          }

          let tableHTML = `
      <table class="attendance-data-table">
        <thead>
          <tr class="stua-table-row" style="background-color:rgb(121, 98, 189); color:white">
            <th>Days</th>
            <th>Event</th>
            <th>Event Count</th>
          </tr>
        </thead>
        <tbody class="table-body">
          ${data
            .map(
              (row, index) => `
            <tr class="stua-table-row" style="${
              index >= 4 ? "display: none" : ""
            }">
              <td>${index + 1}</td>
              <td>${row.event_title}</td>
              <td>${row.count}</td>
            </tr>
          `
            )
            .join("")}
        </tbody>
      </table>
      ${
        data.length > 4
          ? '<div class="show-more-container"><button class="show-more-btn" onclick="showMoreRows(this, ' +
            data.length +
            ')">Show more</button></div>'
          : ""
      }
    `;

          tableContainer.innerHTML = tableHTML;
        } catch (error) {
          console.error("Error fetching attendance data:", error);
          document.getElementById("shimmer-table-for-student-activity").style.display = "none";

          document.querySelector(".stuattend-tablecontainer4").innerHTML =
            '<p class="result">Classes are not started yet. Please Stay tuned for updates.</p>';
        }
      }

      function showMoreRows(btn, totalRows) {
        const tableBody = btn.parentNode.parentNode.querySelector("tbody");
        const rows = Array.from(tableBody.querySelectorAll(".stua-table-row"));
        const hiddenRows = rows.slice(4);

        if (btn.textContent === "Show more") {
          hiddenRows.forEach((row) => (row.style.display = "flex"));
          btn.textContent = "Show less";
        } else {
          hiddenRows.forEach((row) => (row.style.display = "none"));
          btn.textContent = "Show more";
        }
      }

      async function fetchAttendanceDataAndUpdateChart(phaseId) {
        const dailyTestCtx = document
          .getElementById("stuattend-dailyTestChart")
          .getContext("2d");
        const dailyTestChart = new Chart(dailyTestCtx, {
          type: "bar",
          data: {
            labels: [],
            datasets: [
              {
                label: "Events",
                data: [],
                backgroundColor: "#2f4cff",
                borderWidth: 1,
                borderRadius: 20,
                barThickness: 20,
                borderSkipped: false,
              },
            ],
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  stepSize: 10,
                },
                grid: {
                  display: false,
                },
              },
              x: {
                grid: {
                  display: false,
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
            },
          },
        });

        try {
          const response = await fetch(
            `/api/training_phase_analysis/attendance_count/${phaseId}`,
            {
              method: "GET",
            }
          );

          if (!response.ok) {
            throw new Error("Failed to fetch attendance data");
          }

          const data = await response.json();

          if (!data || data.length === 0) {
            document.querySelector(".stuattend-left-card1").innerHTML =
              "<p>No data available</p>";
            return;
          }

          const labels = data.map((item) => {
            const dateString = item.event_title;
            const dayIndex = dateString.lastIndexOf("Day");
            const dayNumber = dateString.substring(dayIndex + 4);
            return `Day ${dayNumber}`;
          });

          const counts = data.map((item) => item.count);

          dailyTestChart.data.labels = labels;
          dailyTestChart.data.datasets[0].data = counts;
          dailyTestChart.update();
        } catch (error) {
          console.error("Error fetching Attendance Data:", error);
          document.querySelector(".stuattend-left-card1").innerHTML =
            '<div class="result">Events are not updated. Please stay tuned for results.</div>';
        }
      }

      //Attendance inactive students response
      let currentInactiveAttendancePage = 1;
const itemsPerPage = 10; // Number of items to display per page
let totalInactiveAttendancePages = 1;
let inactiveAttendanceStudentsData = [];

async function fetchInactiveAttendanceStudents(phaseId) {
  const url = `/api/training_phase_analysis/session_inactive_students/${phaseId}`;

  try {
    const response = await fetch(url);

    if (!response.ok) {
      throw new Error(`Failed to fetch data: ${response.status} ${response.statusText}`);
    }

    inactiveAttendanceStudentsData = await response.json();
    totalInactiveAttendancePages = Math.ceil(inactiveAttendanceStudentsData.length / itemsPerPage);

    const table = document.querySelector(".inactiveAttendance-table-attendance table");
    const noDataMessage = document.getElementById("no-data-message");

    if (inactiveAttendanceStudentsData.length === 0) {
      table.style.display = "none";
      noDataMessage.innerHTML =`
      <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
          <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
          <p style="font-size:16px;line-heigth:24px;">The test has not been conducted yet, so there are no results to show. <br/> Please stay tuned for updates</p>
      </div>
      `;
      noDataMessage.style.display = "block";
      document.getElementById("download-session-inactive-students").style.display = "none"

    } else {
      table.style.display = "table";
      noDataMessage.style.display = "none";
      displayInactiveAttendancePage(currentInactiveAttendancePage);
      updateInactiveAttendancePaginationControls();
    }
  } catch (error) {
    console.error("Error fetching inactive students:", error);
    const noDataMessage = document.getElementById("no-data-message");
    noDataMessage.innerHTML = 
    
    `
    <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
          <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
          <p style="font-size:16px;line-heigth:24px;">The test has not been conducted yet, so there are no results to show. <br/> Please stay tuned for updates</p>
      </div>
    `
    ;


    noDataMessage.style.display = "block";
    document.getElementById("inactiveAttendance-table-body").innerHTML = "";
    document.getElementById("inactiveAttendance-table-header").style.display = "none";
    document.querySelector(".inactiveAttendance-table-attendance table").style.display = "none";
    document.getElementById("download-session-inactive-students").style.display = "none"

  }
}

function displayInactiveAttendancePage(page) {
  const tableBody = document.getElementById("inactiveAttendance-table-body");
  tableBody.innerHTML = "";

  const start = (page - 1) * itemsPerPage;
  const end = start + itemsPerPage;
  const pageData = inactiveAttendanceStudentsData.slice(start, end);

  pageData.forEach((student) => {
    const row = `
      <tr>
        <td class="name-cell">
          <div class="user-icon"><i class="fa-solid fa-user"></i></div>
          ${student.name}
        </td>
        <td>${student.regno}</td>
        <td>${student.email}</td>
        <td>${student.response_count}</td>
      </tr>
    `;
    tableBody.innerHTML += row;
  });
}

function updateInactiveAttendancePaginationControls() {
  const paginationContainer = document.getElementById("pagination-container");
  paginationContainer.innerHTML = "";

  const maxPagesToShow = 7;
  const halfMaxPagesToShow = Math.floor(maxPagesToShow / 2);

  let startPage = Math.max(1, currentInactiveAttendancePage - halfMaxPagesToShow);
  let endPage = Math.min(totalInactiveAttendancePages, startPage + maxPagesToShow - 1);

  if (endPage - startPage < maxPagesToShow - 1) {
    startPage = Math.max(1, endPage - maxPagesToShow + 1);
  }

  // Create and append Previous button
  const prevButton = document.createElement("button");
  prevButton.textContent = "Previous";
  prevButton.onclick = prevInactiveAttendancePage;
  prevButton.id = "prevInactiveAttendancePageBtn";
  prevButton.disabled = currentInactiveAttendancePage === 1;
  paginationContainer.appendChild(prevButton);

  // Create a div to wrap page numbers
  const pageNumbersDiv = document.createElement("div");
  pageNumbersDiv.classList.add("page-numbers-wrapper");

  for (let page = startPage; page <= endPage; page++) {
    const pageButton = document.createElement("span");
    pageButton.textContent = page;
    pageButton.onclick = () => goToInactiveAttendancePage(page);
    pageButton.classList.add("pagination-page");

    if (page === currentInactiveAttendancePage) {
      pageButton.classList.add("active");
    }

    pageNumbersDiv.appendChild(pageButton);
  }

  // Append the div with page numbers to the pagination container
  paginationContainer.appendChild(pageNumbersDiv);

  // Create and append Next button
  const nextButton = document.createElement("button");
  nextButton.textContent = "Next";
  nextButton.onclick = nextInactiveAttendancePage;
  nextButton.id = "nextInactiveAttendancePageBtn";
  nextButton.disabled = currentInactiveAttendancePage === totalInactiveAttendancePages;
  paginationContainer.appendChild(nextButton);
}

function prevInactiveAttendancePage() {
  if (currentInactiveAttendancePage > 1) {
    currentInactiveAttendancePage--;
    displayInactiveAttendancePage(currentInactiveAttendancePage);
    updateInactiveAttendancePaginationControls();
  }
}

function nextInactiveAttendancePage() {
  if (currentInactiveAttendancePage < totalInactiveAttendancePages) {
    currentInactiveAttendancePage++;
    displayInactiveAttendancePage(currentInactiveAttendancePage);
    updateInactiveAttendancePaginationControls();
  }
}

function goToInactiveAttendancePage(page) {
  currentInactiveAttendancePage = page;
  displayInactiveAttendancePage(currentInactiveAttendancePage);
  updateInactiveAttendancePaginationControls();
}

document.addEventListener("DOMContentLoaded", () => {
  let events = [];
  let currentPage = 1;
  const pageSize = 10;
  let totalPages = 0;

  function loadPage(page) {
    const eventTableBody = document.getElementById("event-data");
    eventTableBody.innerHTML = "";

    const paginatedEvents = events.slice((page - 1) * pageSize, page * pageSize);
    document.querySelector(".inactive-table-test").style.display = "block";

    paginatedEvents.forEach((event) => {
      const row = document.createElement("tr");

      row.innerHTML = `
        <td>${event.title}</td>
        <td>${event.total_students}</td>
        <td>${event.present_students}</td>
        <td>${event.absent_students}</td>
        <td>${event.attendance_rate}</td>
        <td>${event.average_100_equivalent_score}</td>
        <td><a href="/api/training_phase_analysis/download-absentees/${event.id}">Download Absentees</a></td>
      `;

      eventTableBody.appendChild(row);
    });

    updatePaginationControls();
  }

  function updatePaginationControls() {
    totalPages = Math.ceil(events.length / pageSize);

    const pageNumbersDiv = document.getElementById("assessmentabsenteespageNumbers");
    pageNumbersDiv.innerHTML = "";

    const maxVisiblePages = 7;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

    if (endPage - startPage < maxVisiblePages - 1) {
      startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }

    if (startPage > 1) {
      const firstPage = document.createElement("span");
      firstPage.innerText = "1";
      firstPage.onclick = () => loadPage(1);
      pageNumbersDiv.appendChild(firstPage);

      if (startPage > 2) {
        const dots = document.createElement("span");
        dots.innerText = "...";
        pageNumbersDiv.appendChild(dots);
      }
    }


    
    // Generate the visible page numbers
    for (let i = startPage; i <= endPage; i++) {
        const pageNumber = document.createElement("span");
        pageNumber.innerText = i;
        pageNumber.onclick = () => {
            currentPage = i;  // Update the currentPage when clicked
            loadPage(i);  // Load the selected page
        };

        // Add active class to the current page
        if (i === currentPage) {
            pageNumber.classList.add("active");
        }

        pageNumbersDiv.appendChild(pageNumber);
    }


    // Add "Last" page link with ellipsis if necessary
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            const dots = document.createElement("span");
            dots.innerText = "...";
            pageNumbersDiv.appendChild(dots);
        }

        const lastPage = document.createElement("span");
        lastPage.innerText = totalPages;
        lastPage.onclick = () => loadPage(totalPages);
        pageNumbersDiv.appendChild(lastPage);
    }

    document.getElementById("assessmentabsenteesprevPage").disabled = currentPage === 1;
    document.getElementById("assessmentabsenteesnextPage").disabled = currentPage === totalPages;
  }

  function absenteesPrevPage() {
    if (currentPage > 1) {
      currentPage--;
      loadPage(currentPage);
    }
  }

  function absenteesNextPage() {
    if (currentPage < totalPages) {
      currentPage++;
      loadPage(currentPage);
    }
  }

  const urlParams = new URLSearchParams(window.location.search);
        const phaseId = urlParams.get("phase_id");

        if (!phaseId) {
          console.error("Phase ID is missing from the URL");
          return;
        }

  
  fetch(`/api/training_phase_analysis/overview/${phaseId}`)
    .then((response) => {
      if (!response.ok) {
        document.getElementById("shimmer-table-for-student-activity").style.display = "none";
        throw new Error("Failed to fetch event data");
      }
      return response.json();
    })
    .then((data) => {
      events = data;
      if (events.length === 0) {
        document.getElementById("testreport-result-message").classList.add("nodata");
        document.getElementById("shimmer-table-for-student-activity").style.display = "none";

        document.getElementById("testreport-result-message").innerHTML =
          `
            <div style="display:flex;flex-direction:column;gap:20px;justify-content:center;align-items:center;height:50vh;">
          <img src="/img/nodata.avif" alt="not-found-image" style="height:150px;width:200px;"/>
          <p style="font-size:16px;line-heigth:24px;">The test has not been conducted yet, so there are no results to show. <br/> Please stay tuned for updates</p>
      </div>

          `;
        document.querySelector(".inactive-table-test").style.display = "none";
        document.getElementById("absentees-pagination-controls").style.display = "none";
        return;
      }

      document.getElementById("summary-dthead").style.opacity = "1";
      totalPages = Math.ceil(events.length / pageSize);
      loadPage(currentPage);
    })
    .catch((error) => {
      console.error("Error fetching event data:", error);
      document.getElementById("testreport-result-message").innerHTML =
        "Failed to fetch event data. Please try again later.";
      document.querySelector(".inactive-table-test").style.display = "none";
      document.getElementById("absentees-pagination-controls").style.display = "none";
      document.getElementById("shimmer-table-for-student-activity").style.display = "none";


    });

  // Attach event listeners for the pagination buttons
  document
    .getElementById("assessmentabsenteesprevPage")
    .addEventListener("click", absenteesPrevPage);
  document
    .getElementById("assessmentabsenteesnextPage")
    .addEventListener("click", absenteesNextPage);
});


document.addEventListener("DOMContentLoaded", () => {
  let events = [];
  let currentPage = 1;
  const pageSize = 10;
  let totalPages = 0;

  const nodataDivSummary2 = document.getElementById("nodata-div-summary2");
  const eventTableBody = document.getElementById("attendance-data");
  const eventDownloadResult = document.getElementById("event-download-result");
  const tableHead = document.getElementById("summary2-table-head");

  const urlParams = new URLSearchParams(window.location.search);
  const phaseId = urlParams.get("phase_id");

  if (!phaseId) {
    console.error("Phase ID is missing from the URL");
    return;
  }

  // Fetch data
  fetch(`/api/training_phase_analysis/report/${phaseId}`)
    .then((response) => {
      if (!response.ok) {
    document.getElementById("shimmer-student-attendance").style.display = "none";

        throw new Error("Failed to fetch event data");
      }
      return response.json();
    })
    .then((data) => {
      events = data;
      document.getElementById("shimmer-student-attendance").style.display = "none";

      if (events.length === 0) {
        nodataDivSummary2.style.display = "block"; // Show no data message
        document.getElementById("attendance-pagination-controls").style.display = "none"; // Hide pagination controls
        return;
      }

      // Show the table head
      tableHead.style.opacity = "1";

      // Set up pagination
      totalPages = Math.ceil(events.length / pageSize);
      loadPage2(currentPage);
    })
    .catch((error) => {
      console.error("Error fetching event data:", error);
      document.getElementById("shimmer-student-attendance").style.display = "none";

      nodataDivSummary2.style.display = "block";
      document.getElementById("attendance-pagination-controls").style.display = "none"; // Hide pagination
    });

  // Load page function
  function loadPage2(page) {
    eventTableBody.innerHTML = ""; // Clear existing rows

    const paginatedEvents = events.slice((page - 1) * pageSize, page * pageSize);
    paginatedEvents.forEach((event) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${event.event_title}</td>
        <td>${event.total_students}</td>
        <td>${event.present_students}</td>
        <td>${event.absent_students}</td>
        <td>${event.hours_covered}</td>
        <td>${event.attendance_rate}</td>
        <td>${event.average_feedback !== null ? event.average_feedback : "N/A"}</td>
        <td>${event.avg_interactiveness_percentage !== null ? event.avg_interactiveness_percentage : "N/A"}</td>
        <td><a href="/api/training_phase_analysis/download-event-absentees/${event.id}">Download Absentees</a></td>
        <td><a href="/feedbackoverview?eventId=${event.id}">View Feedback</a></td>
      `;
      eventTableBody.appendChild(row);
    });

    updatePaginationControls2();
  }

  // Update pagination controls
  function updatePaginationControls2() {
    totalPages = Math.ceil(events.length / pageSize);
    const pageNumbersDiv = document.getElementById("attendance-pageNumbers");
    pageNumbersDiv.innerHTML = ""; // Clear existing page numbers

    const maxVisiblePages = 7;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
    let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

    if (endPage - startPage < maxVisiblePages - 1) {
      startPage = Math.max(1, endPage - maxVisiblePages + 1);
    }

    if (startPage > 1) {
      const firstPage = document.createElement("span");
      firstPage.innerText = "1";
      firstPage.onclick = () => loadPage2(1);
      pageNumbersDiv.appendChild(firstPage);

      if (startPage > 2) {
        const dots = document.createElement("span");
        dots.innerText = "...";
        pageNumbersDiv.appendChild(dots);
      }
    }

     // Generate the visible page numbers
     for (let i = startPage; i <= endPage; i++) {
        const pageNumber = document.createElement("span");
        pageNumber.innerText = i;
        pageNumber.onclick = () => {
            currentPage = i;  // Update the currentPage when clicked
            loadPage2(i);  // Load the selected page
        };

        // Add active class to the current page
        if (i === currentPage) {
            pageNumber.classList.add("active");
        }

        pageNumbersDiv.appendChild(pageNumber);
    }


    // Add "Last" page link with ellipsis if necessary
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            const dots = document.createElement("span");
            dots.innerText = "...";
            pageNumbersDiv.appendChild(dots);
        }

        const lastPage = document.createElement("span");
        lastPage.innerText = totalPages;
        lastPage.onclick = () => loadPage2(totalPages);
        pageNumbersDiv.appendChild(lastPage);
    }

    document.getElementById("attendance-prevPage").disabled = currentPage === 1;
    document.getElementById("attendance-nextPage").disabled = currentPage === totalPages;
  }

  // Pagination controls
  function attendancePrevPage() {
    if (currentPage > 1) {
      currentPage--;
      loadPage(currentPage);
    }
  }

  function attendanceNextPage() {
    if (currentPage < totalPages) {
      currentPage++;
      loadPage(currentPage);
    }
  }


});




  document.addEventListener("DOMContentLoaded", () => {
  const urlParams = new URLSearchParams(window.location.search);
  const phaseId = urlParams.get("phase_id");

  if (!phaseId) {
    console.error("Phase ID is missing from the URL");
    return;
  }

  fetch(`/api/training_phase_analysis/assessments_inactive_students/${phaseId}`)
  .then((response) => {
    if (!response.ok) {
      return response.json().then((errorData) => {
        throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
      });
    }
    return response.json();
  })
  .then((data) => {
    const tableBody = document.getElementById("inactivestudentsassessmentstable-body");
    const tableHead = document.getElementById("inactivestudentsassessmentstable-head");
    const paginationContainer = document.getElementById("inactive-pagination-controls");
    const noDataDiv = document.getElementById("nodataDiv-inactive-test");
    const downloadInactive = document.getElementById('download-inactive-test');
    const noDataDivInactive = document.getElementById("nodata-div-inactive-students");

    // Check for empty or error data
    if (data.error || data.length === 0) {
      noDataDivInactive.style.display = "block";
      tableHead.style.display = "none";
      paginationContainer.style.display = "none";
      downloadInactive.style.display = "none";
      return;
    }

    const inactiveStudents = data;
    noDataDivInactive.style.display = "none";  // Hide no data div if data is present
    downloadInactive.style.display = "block";  // Show download option

    // Pagination variables
    const studentsPerPage = 10;
    let currentPage = 1;
    const totalPages = Math.ceil(inactiveStudents.length / studentsPerPage);

    // Render table function
    function renderTable(page) {
      tableBody.innerHTML = "";  // Clear existing rows
      const start = (page - 1) * studentsPerPage;
      const pageData = inactiveStudents.slice(start, start + studentsPerPage);

      pageData.forEach((student) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${student.name}</td>
          <td>${student.regno}</td>
          <td>${student.email}</td>
          <td>${student.response_count}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Update pagination controls
    function updatePaginationControls() {
      paginationContainer.innerHTML = "";  // Clear previous pagination controls

      const prevButton = document.createElement("button");
      prevButton.textContent = "Previous";
      prevButton.disabled = currentPage === 1;
      prevButton.onclick = () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable(currentPage);
          updatePaginationControls();
        }
      };
      paginationContainer.appendChild(prevButton);

      // Page number logic
      const pagesToShow = Math.min(7, totalPages);
      const halfPagesToShow = Math.floor(pagesToShow / 2);
      let startPage = Math.max(1, currentPage - halfPagesToShow);
      let endPage = Math.min(totalPages, startPage + pagesToShow - 1);

      if (endPage - startPage + 1 < pagesToShow) {
        startPage = Math.max(1, endPage - pagesToShow + 1);
      }

      // Create a container for all the pagination buttons
const pageButtonContainer = document.createElement("div");
pageButtonContainer.classList.add("pagination-buttons-container");

for (let page = startPage; page <= endPage; page++) {
  const pageButton = document.createElement("span");
  pageButton.textContent = page;
  pageButton.classList.add("pagination-page");
  if (page === currentPage) pageButton.classList.add("active");
  pageButton.onclick = () => {
    currentPage = page;
    renderTable(currentPage);
    updatePaginationControls();
  };
  // Append each pageButton to the container
  pageButtonContainer.appendChild(pageButton);
}

// Append the entire container with span elements to paginationContainer
paginationContainer.appendChild(pageButtonContainer);


      const nextButton = document.createElement("button");
      nextButton.textContent = "Next";
      nextButton.disabled = currentPage === totalPages;
      nextButton.onclick = () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderTable(currentPage);
          updatePaginationControls();
        }
      };
      paginationContainer.appendChild(nextButton);
    }

    // Initialize table
    function initializeTable() {
      tableHead.innerHTML = `
        <tr>
          <th>Name</th>
          <th>Registration No</th>
          <th>Email</th>
          <th>Response Count</th>
        </tr>
      `;

      renderTable(currentPage);
      updatePaginationControls();
    }

    initializeTable();
  })
  .catch((error) => {
    console.error("Error fetching inactive student data:", error.message);
    const noDataDivInactive = document.getElementById("nodata-div-inactive-students");
    noDataDivInactive.style.display = "block";
    document.getElementById("inactivestudentsassessmentstable-head").style.display = "none";
    document.getElementById("inactive-pagination-controls").style.display = "none";
    document.getElementById('download-inactive-test').style.display = "none";
  });

  });
   
  window.onload = fetchPhaseDetails;

  // Function to download data as CSV from any API endpoint
// Function to download data as CSV from any API endpoint
function downloadCSV(endpoint) {
  // Extract the phase_id from the URL
  const urlParams = new URLSearchParams(window.location.search);
  const phaseId = urlParams.get('phase_id');

  if (!phaseId) {
    console.error("No phase_id found in URL.");
    return;
  }

  // Fetch all data from the API for the given phase_id
  fetch(`/api/training_phase_analysis/${endpoint}/${phaseId}`)
    .then((response) => response.json())
    .then((data) => {
      if (!data.length) {
        console.error("No data available to download.");
        return;
      }

      // Convert JSON data to CSV
      const csvData = convertToCSV(data);
      const csvBlob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });

      // Create a temporary link to download the CSV file
      const downloadLink = document.createElement('a');
      downloadLink.href = URL.createObjectURL(csvBlob);
      downloadLink.setAttribute('download', `${endpoint}.csv`);
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    })
    .catch((error) => {
      console.error("Error downloading CSV data:", error);
    });
}

// Helper function to convert JSON data to CSV format
function convertToCSV(data) {
  // Flatten each data object including nested hackathon_scores
  const flattenedData = data.map(flattenObjectWithScores);
  
  // Get all unique headers from the flattened data
  const headers = Array.from(new Set(flattenedData.flatMap(obj => Object.keys(obj))));
  
  // Convert each flattened object to a CSV row
  const rows = flattenedData.map(row => headers.map(header => row[header] || "").join(','));
  
  return [headers.join(','), ...rows].join('\n');
}

// Function to flatten a nested object, specifically handling hackathon_scores
function flattenObjectWithScores(obj) {
  const flattened = { ...obj }; // Copy the main object properties
  if (obj.hackathon_scores) {
    Object.entries(obj.hackathon_scores).forEach(([key, value]) => {
      flattened[key] = value; // Add each hackathon score as a separate key-value pair
    });
    delete flattened.hackathon_scores; // Remove the original nested object
  }
  return flattened;
}


    </script>

<script src="js/navbar_logout.js"></script>

    <script src="/js/phase_analysis.js"></script>
  </body>
</html>
